"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4597],{44597:(t,e,r)=>{r.r(e),r.d(e,{DeliveryTrackingService:()=>i});var a=r(66579),o=r(35317);class i{static async updateDeliveryTracking(t){try{let e=(0,o.doc)(a.db,this.collection,t.orderId);return await (0,o.BN)(e,{...t,lastUpdated:o.Dc.now()},{merge:!0}),!0}catch(t){return console.error("Error updating delivery tracking:",t),!1}}static subscribeToDeliveryTracking(t,e){let r=(0,o.doc)(a.db,this.collection,t);return(0,o.aQ)(r,t=>{t.exists()?e({orderId:t.id,...t.data()}):e(null)},t=>{console.error("Error subscribing to delivery tracking:",t),e(null)})}static async updateDriverLocation(t,e){try{let r=(0,o.doc)(a.db,this.collection,t);return await (0,o.mZ)(r,{currentLocation:{...e,timestamp:o.Dc.now()},lastUpdated:o.Dc.now()}),!0}catch(t){return console.error("Error updating driver location:",t),!1}}static async updateETA(t,e){try{let r=(0,o.doc)(a.db,this.collection,t),i={lastUpdated:o.Dc.now()};return e.pickup&&(i.estimatedPickupTime=e.pickup),e.delivery&&(i.estimatedDeliveryTime=e.delivery),e.total&&(i.totalEstimatedTime=e.total),await (0,o.mZ)(r,i),!0}catch(t){return console.error("Error updating ETA:",t),!1}}static async updateDeliveryStep(t,e){try{let r=(0,o.doc)(a.db,this.collection,t);return await (0,o.mZ)(r,{currentStep:e,lastUpdated:o.Dc.now()}),!0}catch(t){return console.error("Error updating delivery step:",t),!1}}static async completeDelivery(t){try{let e=(0,o.doc)(a.db,this.collection,t);return await (0,o.mZ)(e,{currentStep:"delivered",lastUpdated:o.Dc.now()}),!0}catch(t){return console.error("Error completing delivery:",t),!1}}static getCurrentLocation(){return new Promise((t,e)=>{if(!navigator.geolocation)return void e(Error("Geolocation not supported"));navigator.geolocation.getCurrentPosition(e=>{t({lat:e.coords.latitude,lng:e.coords.longitude})},t=>e(t),{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e4})})}static calculateDistance(t,e,r,a){let o=(r-t)*Math.PI/180,i=(a-e)*Math.PI/180,c=Math.sin(o/2)*Math.sin(o/2)+Math.cos(t*Math.PI/180)*Math.cos(r*Math.PI/180)*Math.sin(i/2)*Math.sin(i/2);return 2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c))*6371}static startLocationTracking(t,e,r,a){let o=null,i=0,c=async()=>{try{let e=await this.getCurrentLocation(),r=Date.now();r-i>1e4&&(await this.updateDriverLocation(t,e),i=r),null==a||a(e)}catch(t){console.error("Error updating location:",t)}};return navigator.geolocation&&(o=navigator.geolocation.watchPosition(()=>c(),t=>console.error("Geolocation error:",t),{enableHighAccuracy:!0,timeout:1e4,maximumAge:5e3})),c(),{stop:()=>{null!==o&&navigator.geolocation.clearWatch(o)}}}}i.collection="deliveryTracking"}}]);