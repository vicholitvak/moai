(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8528],{25731:(e,t,o)=>{"use strict";o.d(t,{A:()=>c,AuthProvider:()=>u});var a=o(95155),n=o(12115),l=o(66579),i=o(45404),r=o(35317);let s=(0,n.createContext)({user:null,role:null,loading:!0,logout:async()=>{}}),u=e=>{let{children:t}=e,[o,u]=(0,n.useState)(null),[c,d]=(0,n.useState)(null),[m,h]=(0,n.useState)(!0);(0,n.useEffect)(()=>{let e=(0,i.hg)(l.j,async e=>{try{if(e){u(e);let t="admin@moai.com"===e.email||"admin"===e.uid||e.email&&e.email.includes("admin"),o=(0,r.doc)(l.db,"users",e.uid),a=await (0,r.getDoc)(o),n=0,i=t?2:5;for(;!a.exists()&&n<i;){let t=Math.min(500*Math.pow(2,n),8e3);console.log("AuthContext: Retrying user document fetch (".concat(n+1,"/").concat(i,") after ").concat(t,"ms for ").concat(e.email)),await new Promise(e=>setTimeout(e,t)),a=await (0,r.getDoc)(o),n++}if(a.exists()){let n=a.data().role;t&&"Admin"!==n&&(n="Admin",await (0,r.BN)(o,{role:"Admin"},{merge:!0})),d(n),console.log("AuthContext: User ".concat(e.email," has role: ").concat(n))}else if(t)await (0,r.BN)(o,{role:"Admin"},{merge:!0}),d("Admin"),console.log("AuthContext: Created Admin role for ".concat(e.email));else{console.warn("AuthContext: User ".concat(e.email," document not found after ").concat(n," retries. This may indicate a network issue or missing registration.")),setTimeout(()=>{d(null),console.log("AuthContext: Set role to null for ".concat(e.email," after extended wait"))},2e3);return}}else u(null),d(null)}catch(t){console.error("Auth state change error:",t),e?(u(e),d("admin@moai.com"===e.email||"admin"===e.uid||e.email&&e.email.includes("admin")?"Admin":null)):(u(null),d(null))}finally{h(!1)}});return()=>e()},[]);let g=async()=>{try{await (0,i.CI)(l.j);try{await fetch("/api/auth/logout",{method:"POST"})}catch(e){console.warn("API logout failed, but Firebase logout succeeded:",e)}}catch(e){console.error("Error signing out:",e)}};return(0,a.jsx)(s.Provider,{value:{user:o,role:c,loading:m,logout:g},children:t})},c=()=>(0,n.useContext)(s)},32965:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>r});var a=o(95155),n=o(25731),l=o(35695),i=o(12115);function r(e){let{children:t}=e,{user:o,role:r,loading:s}=(0,n.A)(),u=(0,l.useRouter)(),c=(null==o?void 0:o.email)==="admin@moai.com"||(null==o?void 0:o.uid)==="admin"||(null==o?void 0:o.email)&&o.email.includes("admin");return((0,i.useEffect)(()=>{s||null!==o?s||!o||null==r||"Cooker"===r||c?s||!o||null!==r||c||console.log("CookerLayout: Role is null but letting dashboard handle onboarding"):(console.log("CookerLayout: Redirecting user with role ".concat(r," to login")),u.push("/login")):u.push("/login")},[o,r,s,u,c]),s||!o)?(0,a.jsx)("div",{children:"Loading..."}):"Cooker"===r||null===r||c?(0,a.jsx)(a.Fragment,{children:t}):(0,a.jsx)("div",{children:"Access denied. Please log in with a cooker account."})}},35695:(e,t,o)=>{"use strict";var a=o(18999);o.o(a,"useParams")&&o.d(t,{useParams:function(){return a.useParams}}),o.o(a,"usePathname")&&o.d(t,{usePathname:function(){return a.usePathname}}),o.o(a,"useRouter")&&o.d(t,{useRouter:function(){return a.useRouter}}),o.o(a,"useSearchParams")&&o.d(t,{useSearchParams:function(){return a.useSearchParams}})},55852:(e,t,o)=>{Promise.resolve().then(o.bind(o,32965))},66579:(e,t,o)=>{"use strict";let a;o.d(t,{db:()=>s,j:()=>r,y:()=>a});var n=o(23915),l=o(45404),i=o(35317);a=(0,n.Dk)().length?(0,n.Dk)()[0]:(0,n.Wp)({apiKey:"AIzaSyBptLm3y63BDBH9Xgt_UY40ZjsgUvMOKGI",authDomain:"hometaste-tlpog.firebaseapp.com",projectId:"hometaste-tlpog",storageBucket:"hometaste-tlpog.firebasestorage.app",messagingSenderId:"72297856520",appId:"1:72297856520:web:c7d851e4c00c67ec419bbd"});let r=(0,l.xI)(a),s=(0,i.aU)(a)}},e=>{e.O(0,[9135,3965,2670,8441,5964,7358],()=>e(e.s=55852)),_N_E=e.O()}]);