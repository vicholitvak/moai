(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8294],{25731:(e,r,t)=>{"use strict";t.d(r,{A:()=>c,AuthProvider:()=>d});var a=t(95155),o=t(12115),s=t(66579),n=t(45404),i=t(35317);let l=(0,o.createContext)({user:null,role:null,loading:!0,logout:async()=>{}}),d=e=>{let{children:r}=e,[t,d]=(0,o.useState)(null),[c,m]=(0,o.useState)(null),[u,h]=(0,o.useState)(!0);(0,o.useEffect)(()=>{let e=(0,n.hg)(s.j,async e=>{try{if(e){d(e);let r="admin@moai.com"===e.email||"admin"===e.uid||e.email&&e.email.includes("admin"),t=(0,i.doc)(s.db,"users",e.uid),a=await (0,i.getDoc)(t),o=0,n=r?2:5;for(;!a.exists()&&o<n;){let r=Math.min(500*Math.pow(2,o),8e3);console.log("AuthContext: Retrying user document fetch (".concat(o+1,"/").concat(n,") after ").concat(r,"ms for ").concat(e.email)),await new Promise(e=>setTimeout(e,r)),a=await (0,i.getDoc)(t),o++}if(a.exists()){let o=a.data().role;r&&"Admin"!==o&&(o="Admin",await (0,i.BN)(t,{role:"Admin"},{merge:!0})),m(o),console.log("AuthContext: User ".concat(e.email," has role: ").concat(o))}else if(r)await (0,i.BN)(t,{role:"Admin"},{merge:!0}),m("Admin"),console.log("AuthContext: Created Admin role for ".concat(e.email));else{console.warn("AuthContext: User ".concat(e.email," document not found after ").concat(o," retries. This may indicate a network issue or missing registration.")),setTimeout(()=>{m(null),console.log("AuthContext: Set role to null for ".concat(e.email," after extended wait"))},2e3);return}}else d(null),m(null)}catch(r){console.error("Auth state change error:",r),e?(d(e),m("admin@moai.com"===e.email||"admin"===e.uid||e.email&&e.email.includes("admin")?"Admin":null)):(d(null),m(null))}finally{h(!1)}});return()=>e()},[]);let f=async()=>{try{await (0,n.CI)(s.j);try{await fetch("/api/auth/logout",{method:"POST"})}catch(e){console.warn("API logout failed, but Firebase logout succeeded:",e)}}catch(e){console.error("Error signing out:",e)}};return(0,a.jsx)(l.Provider,{value:{user:t,role:c,loading:u,logout:f},children:r})},c=()=>(0,o.useContext)(l)},53999:(e,r,t)=>{"use strict";t.d(r,{$B:()=>u,$g:()=>n,Dm:()=>d,HM:()=>l,bC:()=>m,cn:()=>s,generateDeliveryCode:()=>i,uA:()=>c});var a=t(52596),o=t(39688);function s(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,o.QP)((0,a.$)(r))}function n(e){return"$".concat(Math.round(e).toLocaleString("es-CL"))}function i(){return Math.floor(1e3+9e3*Math.random()).toString()}function l(e){return e.replace(/(\d{2})(\d{2})/,"$1-$2")}function d(e){let r=0;return e.forEach(e=>{let t=function(e){var r,t;let a=e.toLowerCase();return a.includes("hour")?60*parseFloat((null==(r=a.match(/(\d+(?:\.\d+)?)/))?void 0:r[1])||"1"):a.includes("min")?parseInt((null==(t=a.match(/(\d+)/))?void 0:t[1])||"30"):30}(e.prepTime);t>r&&(r=t)}),r}function c(e,r){return Math.min(Math.max((new Date().getTime()-e.getTime())/6e4/r*100,0),100)}function m(e,r){let t=new Date(e);return t.setMinutes(t.getMinutes()+r),t}function u(e,r){let t=new Date,a=m(e,r).getTime()-t.getTime();if(a<=0)return"Listo";let o=Math.ceil(a/6e4);if(o<60)return"".concat(o," min");{let e=Math.floor(o/60);return"".concat(e,"h ").concat(o%60,"m")}}},54475:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>u});var a=t(95155),o=t(12115),s=t(25731),n=t(35317),i=t(66579),l=t(88482),d=t(97168),c=t(88145),m=t(56671);function u(){var e;let{user:r,role:t,loading:u}=(0,s.A)(),[h,f]=(0,o.useState)(!1),[x,g]=(0,o.useState)(null),v=(0,o.useCallback)(async()=>{if(r)try{let e=(0,n.doc)(i.db,"users",r.uid),t=await (0,n.getDoc)(e);t.exists()&&g(t.data())}catch(e){console.error("Error loading user data:",e)}},[r]);(0,o.useEffect)(()=>{r&&v()},[r,v]);let b=async()=>{if(r){f(!0);try{let e=(0,n.doc)(i.db,"users",r.uid);await (0,n.BN)(e,{role:"Admin"},{merge:!0}),m.oR.success("Admin role set successfully! Please refresh the page."),await v()}catch(e){console.error("Error setting admin role:",e),m.oR.error("Failed to set admin role")}finally{f(!1)}}},p=(null==r?void 0:r.email)==="admin@moai.com"||(null==r?void 0:r.uid)==="admin"||(null==r?void 0:r.email)&&r.email.includes("admin");return u?(0,a.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-moai-orange"})}):r?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 p-8",children:(0,a.jsx)("div",{className:"max-w-2xl mx-auto space-y-6",children:(0,a.jsxs)(l.Zp,{children:[(0,a.jsx)(l.aR,{children:(0,a.jsx)(l.ZB,{children:"Admin Verification & Debug"})}),(0,a.jsxs)(l.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold mb-2",children:"Current User Info"}),(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Email:"})," ",r.email]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"UID:"})," ",r.uid]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Display Name:"})," ",null!=(e=r.displayName)?e:"Not set"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Current Role:"}),(0,a.jsx)(c.E,{className:"ml-2",variant:"Admin"===t?"default":"secondary",children:null!=t?t:"Loading..."})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold mb-2",children:"Admin Status"}),(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Is Admin Email:"}),(0,a.jsx)(c.E,{className:"ml-2",variant:p?"default":"secondary",children:p?"Yes":"No"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Has Admin Role:"}),(0,a.jsx)(c.E,{className:"ml-2",variant:"Admin"===t?"default":"secondary",children:"Admin"===t?"Yes":"No"})]})]})]})]}),x&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold mb-2",children:"Database Data"}),(0,a.jsx)("pre",{className:"bg-gray-100 p-3 rounded text-xs overflow-auto",children:JSON.stringify(x,null,2)})]}),(0,a.jsxs)("div",{className:"border-t pt-4",children:[(0,a.jsx)("h3",{className:"font-semibold mb-2",children:"Actions"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[p&&"Admin"!==t&&(0,a.jsx)(d.$,{onClick:b,disabled:h,className:"bg-moai-orange hover:bg-moai-orange/90",children:h?"Setting...":"Set Admin Role"}),(0,a.jsx)(d.$,{onClick:()=>window.location.reload(),variant:"outline",children:"Refresh Page"}),(0,a.jsx)(d.$,{onClick:()=>window.location.href="/admin/dashboard",variant:"outline",children:"Go to Admin Dashboard"})]})]}),"Admin"===t&&(0,a.jsx)("div",{className:"bg-green-50 border border-green-200 p-3 rounded",children:(0,a.jsx)("p",{className:"text-green-800 text-sm",children:"✅ You have admin access! You should be able to access the admin dashboard."})}),p&&"Admin"!==t&&(0,a.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 p-3 rounded",children:(0,a.jsx)("p",{className:"text-yellow-800 text-sm",children:'⚠️ You have an admin email but your role is not set to Admin. Click "Set Admin Role" above.'})}),!p&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 p-3 rounded",children:(0,a.jsx)("p",{className:"text-red-800 text-sm",children:"❌ Your email is not recognized as an admin email. Contact the system administrator."})})]})]})})}):(0,a.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,a.jsx)(l.Zp,{children:(0,a.jsxs)(l.Wu,{className:"p-8 text-center",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Not Authenticated"}),(0,a.jsx)("p",{children:"Please log in to verify admin access."})]})})})}},58526:(e,r,t)=>{Promise.resolve().then(t.bind(t,54475))},66579:(e,r,t)=>{"use strict";let a;t.d(r,{db:()=>l,j:()=>i,y:()=>a});var o=t(23915),s=t(45404),n=t(35317);a=(0,o.Dk)().length?(0,o.Dk)()[0]:(0,o.Wp)({apiKey:"AIzaSyBptLm3y63BDBH9Xgt_UY40ZjsgUvMOKGI",authDomain:"hometaste-tlpog.firebaseapp.com",projectId:"hometaste-tlpog",storageBucket:"hometaste-tlpog.firebasestorage.app",messagingSenderId:"72297856520",appId:"1:72297856520:web:c7d851e4c00c67ec419bbd"});let i=(0,s.xI)(a),l=(0,n.aU)(a)},88145:(e,r,t)=>{"use strict";t.d(r,{E:()=>i});var a=t(95155);t(12115);var o=t(74466),s=t(53999);let n=(0,o.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:r,variant:t,...o}=e;return(0,a.jsx)("div",{className:(0,s.cn)(n({variant:t}),r),...o})}},88482:(e,r,t)=>{"use strict";t.d(r,{BT:()=>d,Wu:()=>c,ZB:()=>l,Zp:()=>n,aR:()=>i});var a=t(95155),o=t(12115),s=t(53999);let n=o.forwardRef((e,r)=>{let{className:t,...o}=e;return(0,a.jsx)("div",{ref:r,className:(0,s.cn)("rounded-lg border bg-card text-card-foreground shadow-sm transition-all duration-300 hover:shadow-lg",t),...o})});n.displayName="Card";let i=o.forwardRef((e,r)=>{let{className:t,...o}=e;return(0,a.jsx)("div",{ref:r,className:(0,s.cn)("flex flex-col space-y-1.5 p-6",t),...o})});i.displayName="CardHeader";let l=o.forwardRef((e,r)=>{let{className:t,...o}=e;return(0,a.jsx)("h3",{ref:r,className:(0,s.cn)("text-2xl font-semibold leading-none tracking-tight",t),...o})});l.displayName="CardTitle";let d=o.forwardRef((e,r)=>{let{className:t,...o}=e;return(0,a.jsx)("p",{ref:r,className:(0,s.cn)("text-sm text-muted-foreground",t),...o})});d.displayName="CardDescription";let c=o.forwardRef((e,r)=>{let{className:t,...o}=e;return(0,a.jsx)("div",{ref:r,className:(0,s.cn)("p-6 pt-0",t),...o})});c.displayName="CardContent",o.forwardRef((e,r)=>{let{className:t,...o}=e;return(0,a.jsx)("div",{ref:r,className:(0,s.cn)("flex items-center p-6 pt-0",t),...o})}).displayName="CardFooter"},97168:(e,r,t)=>{"use strict";t.d(r,{$:()=>c});var a=t(95155),o=t(12115),s=t(99708),n=t(74466),i=t(38274),l=t(53999);let d=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-xl text-sm font-semibold transition-all duration-300 transform hover:scale-105 active:scale-95 disabled:pointer-events-none disabled:opacity-50 disabled:hover:scale-100 disabled:active:scale-100 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:ring-2 focus-visible:ring-offset-2 relative overflow-hidden group",{variants:{variant:{default:"bg-gradient-to-r from-moai-500 to-moai-600 text-white shadow-lg hover:shadow-xl hover:shadow-moai-500/25 border-0 hover:from-moai-600 hover:to-moai-700",destructive:"bg-gradient-to-r from-red-500 to-red-600 text-white shadow-lg hover:shadow-xl hover:shadow-red-500/25 hover:from-red-600 hover:to-red-700",outline:"border-2 border-moai-200 bg-background/80 backdrop-blur-sm shadow-sm hover:bg-moai-50 hover:text-moai-700 hover:border-moai-300 hover:shadow-md",secondary:"bg-gradient-to-r from-pacific-500 to-pacific-600 text-white shadow-lg hover:shadow-xl hover:shadow-pacific-500/25 hover:from-pacific-600 hover:to-pacific-700",ghost:"hover:bg-moai-50/80 hover:text-moai-700 hover:backdrop-blur-sm",link:"text-moai-600 underline-offset-4 hover:underline hover:text-moai-700 p-0 h-auto shadow-none hover:shadow-none",glass:"bg-white/10 backdrop-blur-md border border-white/20 text-white shadow-lg hover:bg-white/20 hover:shadow-xl",premium:"bg-gradient-to-r from-amber-400 via-orange-500 to-red-500 text-white shadow-lg hover:shadow-xl hover:shadow-orange-500/30 hover:from-amber-500 hover:via-orange-600 hover:to-red-600"},size:{default:"h-11 px-6 py-2",sm:"h-9 rounded-lg gap-1.5 px-4 text-xs",lg:"h-12 rounded-xl px-8 text-base",xl:"h-14 rounded-xl px-10 text-lg",icon:"size-11"}},defaultVariants:{variant:"default",size:"default"}}),c=o.forwardRef((e,r)=>{let{className:t,variant:o,size:n,asChild:c=!1,loading:m=!1,icon:u,glow:h=!1,children:f,...x}=e,g=c?s.DX:"button";return(0,a.jsxs)(g,{className:(0,l.cn)(d({variant:o,size:n,className:t})),ref:r,disabled:m||x.disabled,...x,children:[(0,a.jsx)("div",{className:"absolute inset-0 -translate-x-full group-hover:translate-x-full transition-transform duration-1000 bg-gradient-to-r from-transparent via-white/20 to-transparent"}),h&&(0,a.jsx)("div",{className:"absolute inset-0 rounded-xl bg-gradient-to-r from-moai-500/20 to-pacific-500/20 blur-xl group-hover:blur-2xl transition-all duration-300 opacity-0 group-hover:opacity-100"}),m&&(0,a.jsx)(i.P.div,{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full",animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"}}),u&&!m&&(0,a.jsx)(i.P.div,{whileHover:{scale:1.1},transition:{type:"spring",stiffness:400,damping:10},children:u}),(0,a.jsx)("span",{className:"relative z-10 flex items-center gap-2",children:f})]})});c.displayName="Button"}},e=>{e.O(0,[9135,3965,6331,2670,6671,8441,5964,7358],()=>e(e.s=58526)),_N_E=e.O()}]);