"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8275],{25731:(e,t,r)=>{r.d(t,{A:()=>c,AuthProvider:()=>d});var a=r(95155),o=r(12115),n=r(66579),i=r(45404),l=r(35317);let s=(0,o.createContext)({user:null,role:null,loading:!0,logout:async()=>{}}),d=e=>{let{children:t}=e,[r,d]=(0,o.useState)(null),[c,u]=(0,o.useState)(null),[f,m]=(0,o.useState)(!0);(0,o.useEffect)(()=>{let e=(0,i.hg)(n.j,async e=>{try{if(e){d(e);let t="admin@moai.com"===e.email||"admin"===e.uid||e.email&&e.email.includes("admin"),r=(0,l.doc)(n.db,"users",e.uid),a=await (0,l.getDoc)(r),o=0,i=t?2:5;for(;!a.exists()&&o<i;){let t=Math.min(500*Math.pow(2,o),8e3);console.log("AuthContext: Retrying user document fetch (".concat(o+1,"/").concat(i,") after ").concat(t,"ms for ").concat(e.email)),await new Promise(e=>setTimeout(e,t)),a=await (0,l.getDoc)(r),o++}if(a.exists()){let o=a.data().role;t&&"Admin"!==o&&(o="Admin",await (0,l.BN)(r,{role:"Admin"},{merge:!0})),u(o),console.log("AuthContext: User ".concat(e.email," has role: ").concat(o))}else if(t)await (0,l.BN)(r,{role:"Admin"},{merge:!0}),u("Admin"),console.log("AuthContext: Created Admin role for ".concat(e.email));else{console.warn("AuthContext: User ".concat(e.email," document not found after ").concat(o," retries. This may indicate a network issue or missing registration.")),setTimeout(()=>{u(null),console.log("AuthContext: Set role to null for ".concat(e.email," after extended wait"))},2e3);return}}else d(null),u(null)}catch(t){console.error("Auth state change error:",t),e?(d(e),u("admin@moai.com"===e.email||"admin"===e.uid||e.email&&e.email.includes("admin")?"Admin":null)):(d(null),u(null))}finally{m(!1)}});return()=>e()},[]);let h=async()=>{try{await (0,i.CI)(n.j);try{await fetch("/api/auth/logout",{method:"POST"})}catch(e){console.warn("API logout failed, but Firebase logout succeeded:",e)}}catch(e){console.error("Error signing out:",e)}};return(0,a.jsx)(s.Provider,{value:{user:r,role:c,loading:f,logout:h},children:t})},c=()=>(0,o.useContext)(s)},36515:(e,t,r)=>{r.d(t,{CartProvider:()=>s,_:()=>d});var a=r(95155),o=r(12115),n=r(25731),i=r(46751);let l=(0,o.createContext)({items:[],itemCount:0,totalAmount:0,addToCart:()=>{},removeFromCart:()=>{},updateQuantity:()=>{},clearCart:()=>{},getCartSubtotal:()=>0,getDeliveryFee:()=>0,getServiceFee:()=>0,getTotal:()=>0}),s=e=>{let{children:t}=e,{user:r}=(0,n.A)(),[s,d]=(0,o.useState)([]),[c,u]=(0,o.useState)(null);(0,o.useEffect)(()=>{(async()=>{try{let e=await i.AppSettingsService.getSettings();u(e)}catch(e){console.error("Error loading app settings:",e),u({id:"main",deliveryFee:{baseRate:0,freeDeliveryThreshold:25e3,isEnabled:!1},serviceFee:{percentage:.12,isEnabled:!0},updatedAt:new Date,updatedBy:"system"})}})()},[]),(0,o.useEffect)(()=>{if(r){let e=localStorage.getItem("cart_".concat(r.uid));if(e)try{d(JSON.parse(e))}catch(e){console.error("Error loading cart from localStorage:",e)}}},[r]),(0,o.useEffect)(()=>{r&&localStorage.setItem("cart_".concat(r.uid),JSON.stringify(s))},[s,r]),(0,o.useEffect)(()=>{r||d([])},[r]);let f=e=>{d(t=>t.filter(t=>t.id!==e))},m=()=>s.reduce((e,t)=>e+t.totalPrice,0),h=()=>{if(!c||!c.deliveryFee.isEnabled)return 0;let e=m(),{baseRate:t,freeDeliveryThreshold:r}=c.deliveryFee;return e>=r?0:t},g=()=>c&&c.serviceFee.isEnabled?m()*c.serviceFee.percentage:0,v=()=>m()+h()+g(),p=s.reduce((e,t)=>e+t.quantity,0),x=v();return(0,a.jsx)(l.Provider,{value:{items:s,itemCount:p,totalAmount:x,addToCart:e=>{d(t=>{let r=t.findIndex(t=>t.dishId===e.dishId);if(!(r>=0))return[...t,{...e,id:"".concat(e.dishId,"_").concat(Date.now()),totalPrice:e.price*e.quantity}];{let a=[...t];return a[r]={...a[r],quantity:a[r].quantity+e.quantity,totalPrice:(a[r].quantity+e.quantity)*a[r].price},a}})},removeFromCart:f,updateQuantity:(e,t)=>{if(t<=0)return void f(e);d(r=>r.map(r=>r.id===e?{...r,quantity:t,totalPrice:r.price*t}:r))},clearCart:()=>{d([]),r&&localStorage.removeItem("cart_".concat(r.uid))},getCartSubtotal:m,getDeliveryFee:h,getServiceFee:g,getTotal:v},children:t})},d=()=>{let e=(0,o.useContext)(l);if(!e)throw Error("useCart must be used within a CartProvider");return e}},53999:(e,t,r)=>{r.d(t,{$B:()=>f,$g:()=>i,Dm:()=>d,HM:()=>s,bC:()=>u,cn:()=>n,generateDeliveryCode:()=>l,uA:()=>c});var a=r(52596),o=r(39688);function n(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,o.QP)((0,a.$)(t))}function i(e){return"$".concat(Math.round(e).toLocaleString("es-CL"))}function l(){return Math.floor(1e3+9e3*Math.random()).toString()}function s(e){return e.replace(/(\d{2})(\d{2})/,"$1-$2")}function d(e){let t=0;return e.forEach(e=>{let r=function(e){var t,r;let a=e.toLowerCase();return a.includes("hour")?60*parseFloat((null==(t=a.match(/(\d+(?:\.\d+)?)/))?void 0:t[1])||"1"):a.includes("min")?parseInt((null==(r=a.match(/(\d+)/))?void 0:r[1])||"30"):30}(e.prepTime);r>t&&(t=r)}),t}function c(e,t){return Math.min(Math.max((new Date().getTime()-e.getTime())/6e4/t*100,0),100)}function u(e,t){let r=new Date(e);return r.setMinutes(r.getMinutes()+t),r}function f(e,t){let r=new Date,a=u(e,t).getTime()-r.getTime();if(a<=0)return"Listo";let o=Math.ceil(a/6e4);if(o<60)return"".concat(o," min");{let e=Math.floor(o/60);return"".concat(e,"h ").concat(o%60,"m")}}},66579:(e,t,r)=>{let a;r.d(t,{db:()=>s,j:()=>l,y:()=>a});var o=r(23915),n=r(45404),i=r(35317);a=(0,o.Dk)().length?(0,o.Dk)()[0]:(0,o.Wp)({apiKey:"AIzaSyBptLm3y63BDBH9Xgt_UY40ZjsgUvMOKGI",authDomain:"hometaste-tlpog.firebaseapp.com",projectId:"hometaste-tlpog",storageBucket:"hometaste-tlpog.firebasestorage.app",messagingSenderId:"72297856520",appId:"1:72297856520:web:c7d851e4c00c67ec419bbd"});let l=(0,n.xI)(a),s=(0,i.aU)(a)},69663:(e,t,r)=>{r.d(t,{BK:()=>l,eu:()=>i,q5:()=>s});var a=r(95155),o=r(12115),n=r(53999);let i=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",r),...o})});i.displayName="Avatar";let l=o.forwardRef((e,t)=>{let{className:r,...i}=e,[l,s]=o.useState(!1);return l||!i.src?null:(0,a.jsx)("img",{ref:t,className:(0,n.cn)("aspect-square h-full w-full object-cover",r),onError:()=>s(!0),...i})});l.displayName="AvatarImage";let s=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted text-muted-foreground",r),...o})});s.displayName="AvatarFallback"},88145:(e,t,r)=>{r.d(t,{E:()=>l});var a=r(95155);r(12115);var o=r(74466),n=r(53999);let i=(0,o.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function l(e){let{className:t,variant:r,...o}=e;return(0,a.jsx)("div",{className:(0,n.cn)(i({variant:r}),t),...o})}},88482:(e,t,r)=>{r.d(t,{BT:()=>d,Wu:()=>c,ZB:()=>s,Zp:()=>i,aR:()=>l});var a=r(95155),o=r(12115),n=r(53999);let i=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm transition-all duration-300 hover:shadow-lg",r),...o})});i.displayName="Card";let l=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",r),...o})});l.displayName="CardHeader";let s=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,a.jsx)("h3",{ref:t,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",r),...o})});s.displayName="CardTitle";let d=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,a.jsx)("p",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",r),...o})});d.displayName="CardDescription";let c=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",r),...o})});c.displayName="CardContent",o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",r),...o})}).displayName="CardFooter"},97168:(e,t,r)=>{r.d(t,{$:()=>c});var a=r(95155),o=r(12115),n=r(99708),i=r(74466),l=r(38274),s=r(53999);let d=(0,i.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-xl text-sm font-semibold transition-all duration-300 transform hover:scale-105 active:scale-95 disabled:pointer-events-none disabled:opacity-50 disabled:hover:scale-100 disabled:active:scale-100 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:ring-2 focus-visible:ring-offset-2 relative overflow-hidden group",{variants:{variant:{default:"bg-gradient-to-r from-moai-500 to-moai-600 text-white shadow-lg hover:shadow-xl hover:shadow-moai-500/25 border-0 hover:from-moai-600 hover:to-moai-700",destructive:"bg-gradient-to-r from-red-500 to-red-600 text-white shadow-lg hover:shadow-xl hover:shadow-red-500/25 hover:from-red-600 hover:to-red-700",outline:"border-2 border-moai-200 bg-background/80 backdrop-blur-sm shadow-sm hover:bg-moai-50 hover:text-moai-700 hover:border-moai-300 hover:shadow-md",secondary:"bg-gradient-to-r from-pacific-500 to-pacific-600 text-white shadow-lg hover:shadow-xl hover:shadow-pacific-500/25 hover:from-pacific-600 hover:to-pacific-700",ghost:"hover:bg-moai-50/80 hover:text-moai-700 hover:backdrop-blur-sm",link:"text-moai-600 underline-offset-4 hover:underline hover:text-moai-700 p-0 h-auto shadow-none hover:shadow-none",glass:"bg-white/10 backdrop-blur-md border border-white/20 text-white shadow-lg hover:bg-white/20 hover:shadow-xl",premium:"bg-gradient-to-r from-amber-400 via-orange-500 to-red-500 text-white shadow-lg hover:shadow-xl hover:shadow-orange-500/30 hover:from-amber-500 hover:via-orange-600 hover:to-red-600"},size:{default:"h-11 px-6 py-2",sm:"h-9 rounded-lg gap-1.5 px-4 text-xs",lg:"h-12 rounded-xl px-8 text-base",xl:"h-14 rounded-xl px-10 text-lg",icon:"size-11"}},defaultVariants:{variant:"default",size:"default"}}),c=o.forwardRef((e,t)=>{let{className:r,variant:o,size:i,asChild:c=!1,loading:u=!1,icon:f,glow:m=!1,children:h,...g}=e,v=c?n.DX:"button";return(0,a.jsxs)(v,{className:(0,s.cn)(d({variant:o,size:i,className:r})),ref:t,disabled:u||g.disabled,...g,children:[(0,a.jsx)("div",{className:"absolute inset-0 -translate-x-full group-hover:translate-x-full transition-transform duration-1000 bg-gradient-to-r from-transparent via-white/20 to-transparent"}),m&&(0,a.jsx)("div",{className:"absolute inset-0 rounded-xl bg-gradient-to-r from-moai-500/20 to-pacific-500/20 blur-xl group-hover:blur-2xl transition-all duration-300 opacity-0 group-hover:opacity-100"}),u&&(0,a.jsx)(l.P.div,{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full",animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"}}),f&&!u&&(0,a.jsx)(l.P.div,{whileHover:{scale:1.1},transition:{type:"spring",stiffness:400,damping:10},children:f}),(0,a.jsx)("span",{className:"relative z-10 flex items-center gap-2",children:h})]})});c.displayName="Button"}}]);