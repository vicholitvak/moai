exports.id=9146,exports.ids=[9146],exports.modules={3465:(a,b,c)=>{"use strict";c.d(b,{ThemeProvider:()=>e});var d=c(61369);let e=(0,d.registerClientReference)(function(){throw Error("Attempted to call ThemeProvider() from the server but ThemeProvider is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"D:\\Moai\\moai-app\\contexts\\ThemeContext.tsx","ThemeProvider");(0,d.registerClientReference)(function(){throw Error("Attempted to call useTheme() from the server but useTheme is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"D:\\Moai\\moai-app\\contexts\\ThemeContext.tsx","useTheme"),(0,d.registerClientReference)(function(){throw Error("Attempted to call useIsDarkMode() from the server but useIsDarkMode is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"D:\\Moai\\moai-app\\contexts\\ThemeContext.tsx","useIsDarkMode")},19550:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>e});var d=c(60687);function e({error:a,reset:b}){return(0,d.jsx)("html",{children:(0,d.jsx)("body",{children:(0,d.jsx)("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:(0,d.jsxs)("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-8 text-center",children:[(0,d.jsxs)("div",{className:"mb-6",children:[(0,d.jsx)("div",{className:"mx-auto w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4",children:(0,d.jsx)("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),(0,d.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"\xa1Oops! Algo sali\xf3 mal"}),(0,d.jsx)("p",{className:"text-gray-600",children:"Ha ocurrido un error inesperado. Nuestro equipo ha sido notificado autom\xe1ticamente."})]}),(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsx)("button",{onClick:b,className:"w-full bg-orange-600 hover:bg-orange-700 text-white font-medium py-3 px-4 rounded-lg transition-colors",children:"Intentar de nuevo"}),(0,d.jsx)("button",{onClick:()=>window.location.href="/client/home",className:"w-full bg-gray-100 hover:bg-gray-200 text-gray-900 font-medium py-3 px-4 rounded-lg transition-colors",children:"Volver al inicio"})]}),(0,d.jsxs)("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[(0,d.jsxs)("p",{className:"text-sm text-gray-500",children:["Si el problema persiste, contacta a"," ",(0,d.jsx)("a",{href:"/support",className:"text-orange-600 hover:text-orange-700 underline",children:"soporte t\xe9cnico"})]}),a.digest&&(0,d.jsxs)("p",{className:"text-xs text-gray-400 mt-2 font-mono",children:["Error ID: ",a.digest]})]})]})})})})}c(50981),c(43210)},20253:(a,b,c)=>{"use strict";c.d(b,{UserProfileProvider:()=>e});var d=c(61369);let e=(0,d.registerClientReference)(function(){throw Error("Attempted to call UserProfileProvider() from the server but UserProfileProvider is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"D:\\Moai\\moai-app\\context\\UserProfileContext.tsx","UserProfileProvider");(0,d.registerClientReference)(function(){throw Error("Attempted to call useUserProfile() from the server but useUserProfile is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"D:\\Moai\\moai-app\\context\\UserProfileContext.tsx","useUserProfile")},21295:(a,b,c)=>{"use strict";c.d(b,{A:()=>k,AuthProvider:()=>j});var d=c(60687),e=c(43210),f=c(56525),g=c(61448),h=c(75535);let i=(0,e.createContext)({user:null,role:null,loading:!0,logout:async()=>{}}),j=({children:a})=>{let[b,c]=(0,e.useState)(null),[j,k]=(0,e.useState)(null),[l,m]=(0,e.useState)(!0);(0,e.useEffect)(()=>{let a=(0,g.hg)(f.j,async a=>{try{if(a){c(a);let b="admin@moai.com"===a.email||"admin"===a.uid||a.email&&a.email.includes("admin"),d=(0,h.doc)(f.db,"users",a.uid),e=await (0,h.getDoc)(d),g=0,i=b?2:5;for(;!e.exists()&&g<i;){let b=Math.min(500*Math.pow(2,g),8e3);console.log(`AuthContext: Retrying user document fetch (${g+1}/${i}) after ${b}ms for ${a.email}`),await new Promise(a=>setTimeout(a,b)),e=await (0,h.getDoc)(d),g++}if(e.exists()){let c=e.data().role;b&&"Admin"!==c&&(c="Admin",await (0,h.BN)(d,{role:"Admin"},{merge:!0})),k(c),console.log(`AuthContext: User ${a.email} has role: ${c}`)}else if(b)await (0,h.BN)(d,{role:"Admin"},{merge:!0}),k("Admin"),console.log(`AuthContext: Created Admin role for ${a.email}`);else{console.warn(`AuthContext: User ${a.email} document not found after ${g} retries. This may indicate a network issue or missing registration.`),setTimeout(()=>{k(null),console.log(`AuthContext: Set role to null for ${a.email} after extended wait`)},2e3);return}}else c(null),k(null)}catch(b){console.error("Auth state change error:",b),a?(c(a),k("admin@moai.com"===a.email||"admin"===a.uid||a.email&&a.email.includes("admin")?"Admin":null)):(c(null),k(null))}finally{m(!1)}});return()=>a()},[]);let n=async()=>{try{await (0,g.CI)(f.j);try{await fetch("/api/auth/logout",{method:"POST"})}catch(a){console.warn("API logout failed, but Firebase logout succeeded:",a)}}catch(a){console.error("Error signing out:",a)}};return(0,d.jsx)(i.Provider,{value:{user:b,role:j,loading:l,logout:n},children:a})},k=()=>(0,e.useContext)(i)},23856:(a,b,c)=>{"use strict";c.d(b,{SupportButton:()=>d});let d=(0,c(61369).registerClientReference)(function(){throw Error("Attempted to call SupportButton() from the server but SupportButton is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"D:\\Moai\\moai-app\\components\\support\\SupportButton.tsx","SupportButton")},24934:(a,b,c)=>{"use strict";c.d(b,{$:()=>k});var d=c(60687),e=c(43210),f=c(8730),g=c(24224),h=c(92576),i=c(96241);let j=(0,g.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-xl text-sm font-semibold transition-all duration-300 transform hover:scale-105 active:scale-95 disabled:pointer-events-none disabled:opacity-50 disabled:hover:scale-100 disabled:active:scale-100 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:ring-2 focus-visible:ring-offset-2 relative overflow-hidden group",{variants:{variant:{default:"bg-gradient-to-r from-moai-500 to-moai-600 text-white shadow-lg hover:shadow-xl hover:shadow-moai-500/25 border-0 hover:from-moai-600 hover:to-moai-700",destructive:"bg-gradient-to-r from-red-500 to-red-600 text-white shadow-lg hover:shadow-xl hover:shadow-red-500/25 hover:from-red-600 hover:to-red-700",outline:"border-2 border-moai-200 bg-background/80 backdrop-blur-sm shadow-sm hover:bg-moai-50 hover:text-moai-700 hover:border-moai-300 hover:shadow-md",secondary:"bg-gradient-to-r from-pacific-500 to-pacific-600 text-white shadow-lg hover:shadow-xl hover:shadow-pacific-500/25 hover:from-pacific-600 hover:to-pacific-700",ghost:"hover:bg-moai-50/80 hover:text-moai-700 hover:backdrop-blur-sm",link:"text-moai-600 underline-offset-4 hover:underline hover:text-moai-700 p-0 h-auto shadow-none hover:shadow-none",glass:"bg-white/10 backdrop-blur-md border border-white/20 text-white shadow-lg hover:bg-white/20 hover:shadow-xl",premium:"bg-gradient-to-r from-amber-400 via-orange-500 to-red-500 text-white shadow-lg hover:shadow-xl hover:shadow-orange-500/30 hover:from-amber-500 hover:via-orange-600 hover:to-red-600"},size:{default:"h-11 px-6 py-2",sm:"h-9 rounded-lg gap-1.5 px-4 text-xs",lg:"h-12 rounded-xl px-8 text-base",xl:"h-14 rounded-xl px-10 text-lg",icon:"size-11"}},defaultVariants:{variant:"default",size:"default"}}),k=e.forwardRef(({className:a,variant:b,size:c,asChild:e=!1,loading:g=!1,icon:k,glow:l=!1,children:m,...n},o)=>{let p=e?f.DX:"button";return(0,d.jsxs)(p,{className:(0,i.cn)(j({variant:b,size:c,className:a})),ref:o,disabled:g||n.disabled,...n,children:[(0,d.jsx)("div",{className:"absolute inset-0 -translate-x-full group-hover:translate-x-full transition-transform duration-1000 bg-gradient-to-r from-transparent via-white/20 to-transparent"}),l&&(0,d.jsx)("div",{className:"absolute inset-0 rounded-xl bg-gradient-to-r from-moai-500/20 to-pacific-500/20 blur-xl group-hover:blur-2xl transition-all duration-300 opacity-0 group-hover:opacity-100"}),g&&(0,d.jsx)(h.P.div,{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full",animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"}}),k&&!g&&(0,d.jsx)(h.P.div,{whileHover:{scale:1.1},transition:{type:"spring",stiffness:400,damping:10},children:k}),(0,d.jsx)("span",{className:"relative z-10 flex items-center gap-2",children:m})]})});k.displayName="Button"},26542:(a,b,c)=>{"use strict";c.d(b,{SupportButton:()=>m});var d=c(60687),e=c(43210),f=c(11860),g=c(44709),h=c(58887),i=c(24934),j=c(16189),k=c(92576),l=c(88920);function m(){let[a,b]=(0,e.useState)(!1),c=(0,j.useRouter)();return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(k.P.div,{className:"fixed bottom-6 right-6 z-50",initial:{scale:0},animate:{scale:1},transition:{delay:1,type:"spring",stiffness:260,damping:20},children:(0,d.jsx)(i.$,{onClick:()=>b(!a),className:"h-14 w-14 rounded-full shadow-lg bg-atacama-orange hover:bg-atacama-orange/90",size:"icon",children:(0,d.jsx)(l.N,{mode:"wait",children:a?(0,d.jsx)(k.P.div,{initial:{rotate:-90,opacity:0},animate:{rotate:0,opacity:1},exit:{rotate:90,opacity:0},transition:{duration:.2},children:(0,d.jsx)(f.A,{className:"h-6 w-6"})},"close"):(0,d.jsx)(k.P.div,{initial:{rotate:90,opacity:0},animate:{rotate:0,opacity:1},exit:{rotate:-90,opacity:0},transition:{duration:.2},children:(0,d.jsx)(g.A,{className:"h-6 w-6"})},"help")})})}),(0,d.jsx)(l.N,{children:a&&(0,d.jsxs)(k.P.div,{className:"fixed bottom-24 right-6 z-40 bg-background border rounded-lg shadow-xl p-4 w-64",initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:20,scale:.95},transition:{duration:.2},children:[(0,d.jsx)("h3",{className:"font-semibold mb-3",children:"\xbfNecesitas ayuda?"}),(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsxs)(i.$,{variant:"outline",className:"w-full justify-start",onClick:()=>{c.push("/support"),b(!1)},children:[(0,d.jsx)(g.A,{className:"h-4 w-4 mr-2"}),"Centro de Ayuda"]}),(0,d.jsxs)(i.$,{variant:"outline",className:"w-full justify-start",onClick:()=>{c.push("/support#contact"),b(!1)},children:[(0,d.jsx)(h.A,{className:"h-4 w-4 mr-2"}),"Contactar Soporte"]})]}),(0,d.jsx)("div",{className:"mt-3 pt-3 border-t",children:(0,d.jsx)("p",{className:"text-xs text-muted-foreground",children:"Horario de atenci\xf3n: 9AM - 9PM"})})]})})]})}},34997:a=>{function b(a){var b=Error("Cannot find module '"+a+"'");throw b.code="MODULE_NOT_FOUND",b}b.keys=()=>[],b.resolve=b,b.id=34997,a.exports=b},39856:(a,b,c)=>{"use strict";c.d(b,{default:()=>C});var d=c(60687),e=c(43210),f=c(54858),g=c(24934),h=c(59821),i=c(92241),j=c(33872),k=c(11860),l=c(46672),m=c(21295),n=c(55192),o=c(70373),p=c(68988),q=c(71057),r=c(41312),s=c(99270),t=c(78201),u=c(41585);function v({onSelectRoom:a,selectedRoomId:b,className:c}){let{user:f}=(0,m.A)(),[i,k]=(0,e.useState)([]),[l,v]=(0,e.useState)(!0),[w,x]=(0,e.useState)(""),[y,z]=(0,e.useState)("all"),A=i.filter(a=>{if("all"!==y&&a.type!==y)return!1;if(w){let b=w.toLowerCase(),c=Object.values(a.participantDetails).map(a=>a.name.toLowerCase()).join(" "),d=a.lastMessage?.message.toLowerCase()||"";return c.includes(b)||d.includes(b)}return!0});return l?(0,d.jsx)(n.Zp,{className:c,children:(0,d.jsx)(n.Wu,{className:"flex items-center justify-center h-96",children:(0,d.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):(0,d.jsxs)(n.Zp,{className:c,children:[(0,d.jsxs)(n.aR,{children:[(0,d.jsxs)(n.ZB,{className:"flex items-center space-x-2",children:[(0,d.jsx)(j.A,{className:"h-5 w-5"}),(0,d.jsx)("span",{children:"Chats"}),i.length>0&&(0,d.jsx)(h.E,{variant:"secondary",children:i.length})]}),(0,d.jsxs)("div",{className:"relative",children:[(0,d.jsx)(s.A,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),(0,d.jsx)(p.p,{placeholder:"Buscar chats...",value:w,onChange:a=>x(a.target.value),className:"pl-9"})]}),(0,d.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,d.jsx)(g.$,{variant:"all"===y?"default":"outline",size:"sm",onClick:()=>z("all"),children:"Todos"}),(0,d.jsxs)(g.$,{variant:"order"===y?"default":"outline",size:"sm",onClick:()=>z("order"),children:[(0,d.jsx)(q.A,{className:"h-3 w-3 mr-1"}),"Pedidos"]}),(0,d.jsxs)(g.$,{variant:"support"===y?"default":"outline",size:"sm",onClick:()=>z("support"),children:[(0,d.jsx)(j.A,{className:"h-3 w-3 mr-1"}),"Soporte"]}),(0,d.jsxs)(g.$,{variant:"direct"===y?"default":"outline",size:"sm",onClick:()=>z("direct"),children:[(0,d.jsx)(r.A,{className:"h-3 w-3 mr-1"}),"Directos"]})]})]}),(0,d.jsx)(n.Wu,{className:"p-0",children:0===A.length?(0,d.jsxs)("div",{className:"flex flex-col items-center justify-center h-48 text-muted-foreground",children:[(0,d.jsx)(j.A,{className:"h-12 w-12 mb-4 opacity-50"}),(0,d.jsx)("p",{className:"text-center",children:w?"No se encontraron chats":"No tienes chats a\xfan"}),!w&&(0,d.jsx)("p",{className:"text-sm text-center mt-2",children:"Los chats se crear\xe1n autom\xe1ticamente cuando recibas pedidos"})]}):(0,d.jsx)("div",{className:"space-y-1",children:A.map(c=>{let e=b===c.id,g=c.unreadCount[f?.uid||""]||0;return(0,d.jsxs)("div",{onClick:()=>a(c.id),className:`flex items-center space-x-3 p-3 hover:bg-muted cursor-pointer transition-colors ${e?"bg-muted border-r-2 border-primary":""}`,children:[(0,d.jsx)("div",{className:"flex-shrink-0",children:(0,d.jsx)("div",{className:"w-10 h-10 bg-muted rounded-full flex items-center justify-center",children:(a=>{switch(a.type){case"order":return(0,d.jsx)(q.A,{className:"h-4 w-4"});case"support":default:return(0,d.jsx)(j.A,{className:"h-4 w-4"});case"direct":return(0,d.jsx)(r.A,{className:"h-4 w-4"})}})(c)})}),(0,d.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsx)("h4",{className:`text-sm font-medium truncate ${g>0?"font-semibold":""}`,children:"order"===c.type?`Pedido #${c.orderId?.slice(-8)}`:Object.entries(c.participantDetails).filter(([a])=>a!==f?.uid).map(([,a])=>a.name).join(", ")||"Chat"}),(0,d.jsxs)("div",{className:"flex items-center space-x-2 flex-shrink-0",children:[c.lastMessage?.timestamp&&(0,d.jsx)("span",{className:"text-xs text-muted-foreground",children:(a=>{if(!a)return"";let b=a.toDate?a.toDate():new Date(a);return(0,t.m)(b,{addSuffix:!0,locale:u.es})})(c.lastMessage.timestamp)}),g>0&&(0,d.jsx)(h.E,{variant:"destructive",className:"text-xs min-w-[20px] h-5 flex items-center justify-center px-1",children:g>99?"99+":g})]})]}),(0,d.jsx)("p",{className:`text-xs text-muted-foreground truncate mt-1 ${g>0?"font-medium":""}`,children:"order"===c.type&&"order"===c.type?Object.entries(c.participantDetails).filter(([a])=>a!==f?.uid).map(([,a])=>`${a.name} (${(a=>{switch(a){case"cooker":return"Cocinero";case"driver":return"Conductor";case"customer":return"Cliente";case"admin":return"Admin";default:return"Usuario"}})(a.role)})`).join(", "):c.lastMessage?.message||"Sin mensajes"}),"order"!==c.type&&(0,d.jsx)("div",{className:"flex items-center space-x-1 mt-1",children:Object.entries(c.participantDetails).filter(([a])=>a!==f?.uid).slice(0,3).map(([a,b])=>(0,d.jsxs)(o.eu,{className:"w-4 h-4",children:[(0,d.jsx)(o.BK,{src:b.avatar}),(0,d.jsx)(o.q5,{className:"text-xs",children:b.name.charAt(0).toUpperCase()})]},a))})]})]},c.id)})})})]})}var w=c(48340),x=c(81904),y=c(97992),z=c(40945),A=c(27900);function B({roomId:a,onClose:b,className:c}){let{user:f}=(0,m.A)(),[i,j]=(0,e.useState)([]),[q,r]=(0,e.useState)(""),[s,v]=(0,e.useState)(!0),[B,C]=(0,e.useState)(!1),[D,E]=(0,e.useState)(null),F=(0,e.useRef)(null),G=async()=>{q.trim()&&f&&!B&&(C(!0),await l.ChatService.sendMessage(a,f.uid,q.trim())&&r(""),C(!1))},H=async()=>{f&&navigator.geolocation&&navigator.geolocation.getCurrentPosition(async b=>{let{latitude:c,longitude:d}=b.coords,e=`${c.toFixed(6)}, ${d.toFixed(6)}`;await l.ChatService.sendLocationMessage(a,f.uid,{lat:c,lng:d,address:e})},a=>{console.error("Error getting location:",a)})},I=a=>{switch(a){case"cooker":return"bg-orange-100 text-orange-800";case"driver":return"bg-blue-100 text-blue-800";case"customer":return"bg-green-100 text-green-800";case"admin":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}},J=a=>{switch(a){case"cooker":return"Cocinero";case"driver":return"Conductor";case"customer":return"Cliente";case"admin":return"Sistema";default:return"Usuario"}};return s?(0,d.jsx)(n.Zp,{className:c,children:(0,d.jsx)(n.Wu,{className:"flex items-center justify-center h-96",children:(0,d.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):(0,d.jsxs)(n.Zp,{className:c,children:[(0,d.jsxs)(n.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-4",children:[(0,d.jsx)("div",{className:"flex items-center space-x-3",children:(0,d.jsxs)("div",{children:[(0,d.jsx)(n.ZB,{className:"text-lg",children:D?.type==="order"?`Pedido #${D.orderId?.slice(-8)}`:"Chat"}),(0,d.jsx)("div",{className:"flex items-center space-x-2 mt-1",children:D&&Object.entries(D.participantDetails).filter(([a])=>a!==f?.uid).map(([a,b])=>(0,d.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,d.jsx)(h.E,{variant:"outline",className:I(b.role),children:J(b.role)}),(0,d.jsx)("span",{className:"text-sm text-muted-foreground",children:b.name})]},a))})]})}),(0,d.jsxs)("div",{className:"flex items-center space-x-2",children:[D?.type==="order"&&(0,d.jsx)(g.$,{variant:"outline",size:"sm",children:(0,d.jsx)(w.A,{className:"h-4 w-4"})}),(0,d.jsx)(g.$,{variant:"ghost",size:"sm",children:(0,d.jsx)(x.A,{className:"h-4 w-4"})}),b&&(0,d.jsx)(g.$,{variant:"ghost",size:"sm",onClick:b,children:(0,d.jsx)(k.A,{className:"h-4 w-4"})})]})]}),(0,d.jsxs)(n.Wu,{className:"p-0",children:[(0,d.jsxs)("div",{className:"h-96 overflow-y-auto px-4 space-y-4",children:[0===i.length?(0,d.jsx)("div",{className:"flex items-center justify-center h-full text-muted-foreground",children:(0,d.jsxs)("div",{className:"text-center",children:[(0,d.jsx)("p",{children:"No hay mensajes a\xfan"}),(0,d.jsx)("p",{className:"text-sm",children:"Env\xeda el primer mensaje para comenzar la conversaci\xf3n"})]})}):i.map(a=>{let b=a.senderId===f?.uid;return"system"===a.senderId?(0,d.jsx)("div",{className:"flex justify-center",children:(0,d.jsx)("div",{className:"bg-muted text-muted-foreground px-3 py-1 rounded-full text-sm",children:a.message})},a.id):(0,d.jsx)("div",{className:`flex ${b?"justify-end":"justify-start"}`,children:(0,d.jsxs)("div",{className:`flex max-w-[70%] ${b?"flex-row-reverse":"flex-row"} items-start space-x-2`,children:[!b&&(0,d.jsxs)(o.eu,{className:"w-8 h-8",children:[(0,d.jsx)(o.BK,{src:a.senderAvatar}),(0,d.jsx)(o.q5,{className:"text-xs",children:a.senderName.charAt(0).toUpperCase()})]}),(0,d.jsxs)("div",{className:`${b?"mr-2":"ml-2"}`,children:[!b&&(0,d.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,d.jsx)("span",{className:"text-sm font-medium",children:a.senderName}),(0,d.jsx)(h.E,{variant:"outline",className:`text-xs ${I(a.senderRole)}`,children:J(a.senderRole)})]}),(0,d.jsx)("div",{className:`rounded-lg px-3 py-2 ${b?"bg-primary text-primary-foreground":"bg-muted"}`,children:"location"===a.type&&a.metadata?.location?(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,d.jsx)(y.A,{className:"h-4 w-4"}),(0,d.jsx)("span",{children:"Ubicaci\xf3n compartida"})]}),(0,d.jsx)("p",{className:"text-sm opacity-90",children:a.metadata.location.address}),(0,d.jsx)(g.$,{variant:b?"secondary":"default",size:"sm",onClick:()=>{let{lat:b,lng:c}=a.metadata.location;window.open(`https://www.google.com/maps?q=${b},${c}`,"_blank")},children:"Ver en Maps"})]}):(0,d.jsx)("p",{className:"whitespace-pre-wrap",children:a.message})}),(0,d.jsxs)("div",{className:`flex items-center space-x-1 mt-1 ${b?"justify-end":"justify-start"}`,children:[(0,d.jsx)("span",{className:"text-xs text-muted-foreground",children:(a=>{if(!a)return"";let b=a.toDate?a.toDate():new Date(a);return(0,t.m)(b,{addSuffix:!0,locale:u.es})})(a.timestamp)}),b&&(0,d.jsx)("div",{className:"flex items-center",children:(0,d.jsx)(z.A,{className:`h-3 w-3 ${a.readBy.length>1?"text-blue-500":"text-muted-foreground"}`})}),a.edited&&(0,d.jsx)("span",{className:"text-xs text-muted-foreground",children:"(editado)"})]})]})]})},a.id)}),(0,d.jsx)("div",{ref:F})]}),(0,d.jsx)("div",{className:"border-t p-4",children:(0,d.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,d.jsx)(g.$,{variant:"outline",size:"sm",onClick:H,className:"flex-shrink-0",children:(0,d.jsx)(y.A,{className:"h-4 w-4"})}),(0,d.jsxs)("div",{className:"flex-1 flex items-center space-x-2",children:[(0,d.jsx)(p.p,{value:q,onChange:a=>r(a.target.value),onKeyPress:a=>{"Enter"!==a.key||a.shiftKey||(a.preventDefault(),G())},placeholder:"Escribe un mensaje...",disabled:B,className:"flex-1"}),(0,d.jsx)(g.$,{onClick:G,disabled:!q.trim()||B,size:"sm",children:B?(0,d.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):(0,d.jsx)(A.A,{className:"h-4 w-4"})})]})]})})]})]})}function C({className:a}){let{totalUnreadCount:b}=(0,f.Y)(),[c,l]=(0,e.useState)(!1),[m,n]=(0,e.useState)(null),o=a=>{n(a)},p=()=>{n(null)};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"hidden md:block",children:(0,d.jsxs)(i.cj,{open:c,onOpenChange:l,children:[(0,d.jsx)(i.CG,{asChild:!0,children:(0,d.jsx)(g.$,{className:`fixed bottom-6 right-6 h-14 w-14 rounded-full shadow-lg hover:shadow-xl transition-all duration-200 z-50 ${a}`,size:"icon",children:(0,d.jsxs)("div",{className:"relative",children:[(0,d.jsx)(j.A,{className:"h-6 w-6"}),b>0&&(0,d.jsx)(h.E,{variant:"destructive",className:"absolute -top-2 -right-2 min-w-[20px] h-5 flex items-center justify-center px-1 text-xs",children:b>99?"99+":b})]})})}),(0,d.jsxs)(i.h,{side:"right",className:"w-full sm:w-[800px] p-0",children:[(0,d.jsx)(i.Fm,{className:"sr-only",children:(0,d.jsx)(i.qp,{children:"Chat"})}),(0,d.jsxs)("div",{className:"flex h-full",children:[(0,d.jsx)("div",{className:`${m?"hidden lg:flex":"flex"} w-full lg:w-1/3 border-r`,children:(0,d.jsx)(v,{onSelectRoom:o,selectedRoomId:m||void 0,className:"w-full border-none"})}),m&&(0,d.jsxs)("div",{className:"flex-1",children:[(0,d.jsx)("div",{className:"lg:hidden p-4 border-b",children:(0,d.jsx)(g.$,{variant:"ghost",onClick:p,children:"â† Volver a chats"})}),(0,d.jsx)(B,{roomId:m,className:"border-none h-full"})]}),!m&&(0,d.jsx)("div",{className:"hidden lg:flex flex-1 items-center justify-center bg-muted/30",children:(0,d.jsxs)("div",{className:"text-center text-muted-foreground",children:[(0,d.jsx)(j.A,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,d.jsx)("p",{children:"Selecciona un chat para comenzar"})]})})]})]})]})}),(0,d.jsxs)("div",{className:"md:hidden",children:[(0,d.jsx)(g.$,{onClick:()=>l(!0),className:`fixed bottom-6 right-6 h-14 w-14 rounded-full shadow-lg hover:shadow-xl transition-all duration-200 z-50 ${a}`,size:"icon",children:(0,d.jsxs)("div",{className:"relative",children:[(0,d.jsx)(j.A,{className:"h-6 w-6"}),b>0&&(0,d.jsx)(h.E,{variant:"destructive",className:"absolute -top-2 -right-2 min-w-[20px] h-5 flex items-center justify-center px-1 text-xs",children:b>99?"99+":b})]})}),c&&(0,d.jsxs)("div",{className:"fixed inset-0 bg-background z-50 flex flex-col",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,d.jsx)("h1",{className:"text-lg font-semibold",children:m?"Chat":"Chats"}),(0,d.jsxs)("div",{className:"flex items-center space-x-2",children:[m&&(0,d.jsx)(g.$,{variant:"ghost",size:"sm",onClick:p,children:"â† Volver"}),(0,d.jsx)(g.$,{variant:"ghost",size:"sm",onClick:()=>l(!1),children:(0,d.jsx)(k.A,{className:"h-4 w-4"})})]})]}),(0,d.jsx)("div",{className:"flex-1 overflow-hidden",children:m?(0,d.jsx)(B,{roomId:m,className:"h-full border-none"}):(0,d.jsx)(v,{onSelectRoom:o,className:"h-full border-none"})})]})]})]})}},40303:(a,b,c)=>{"use strict";c.d(b,{D:()=>h,ThemeProvider:()=>g});var d=c(60687),e=c(43210);let f=(0,e.createContext)(void 0);function g({children:a}){let[b,c]=(0,e.useState)("system"),[g,h]=(0,e.useState)("light"),[i,j]=(0,e.useState)(!1),k="system"===b?g:b;return i?(0,d.jsx)(f.Provider,{value:{theme:b,setTheme:a=>{console.log("ThemeContext: Setting theme to",a),c(a)},systemTheme:g,resolvedTheme:k,toggleTheme:()=>{"light"===b?c("dark"):"dark"===b?c("system"):c("light")}},children:a}):(0,d.jsx)(d.Fragment,{children:a})}function h(){let a=(0,e.useContext)(f);if(void 0===a)throw Error("useTheme must be used within a ThemeProvider");return a}},40332:(a,b,c)=>{"use strict";c.d(b,{z:()=>i});var d=c(50981),e=c(61448),f=c(75535),g=c(56525);class h{constructor(){this.userId=null,this.userRole=null,this.initializeUserContext()}static getInstance(){return h.instance||(h.instance=new h),h.instance}async initializeUserContext(){try{let a=(0,e.xI)().currentUser;if(a){this.userId=a.uid;let b=await (0,f.getDoc)((0,f.doc)(g.db,"users",a.uid));b.exists()&&(this.userRole=b.data().role||"client"),d.setUser({id:a.uid,email:a.email||void 0,role:this.userRole}),d.setTags({user_role:this.userRole,user_id:a.uid})}}catch(a){console.error("Error initializing user context:",a)}}trackEvent(a){try{d.addBreadcrumb({category:a.category,message:`${a.action}${a.label?` - ${a.label}`:""}`,level:"info",data:{value:a.value,metadata:a.metadata,userId:a.userId||this.userId}})}catch(a){console.error("Error tracking event:",a)}}trackPerformance(a){try{d.addBreadcrumb({category:"performance",message:`Performance: ${a.name} = ${a.value}${a.unit}`,level:"info",data:{...a,user_role:this.userRole}})}catch(a){console.error("Error tracking performance:",a)}}trackApiCall(a,b,c,d){this.trackEvent({category:"api_call",action:`${b} ${a}`,value:c,metadata:{success:d,endpoint:a,method:b,duration:c}}),this.trackPerformance({name:"api_response_time",value:c,unit:"ms",tags:{endpoint:a,method:b,success:d.toString()}})}trackPayment(a,b,c,d){this.trackEvent({category:"payment",action:d?"payment_success":"payment_failed",value:a,label:`${c} - ${b}`,metadata:{amount:a,currency:b,method:c,success:d}})}trackOrder(a,b,c){this.trackEvent({category:"order",action:`order_${b}`,label:a,value:c,metadata:{orderId:a,status:b,value:c}})}trackUserAction(a,b,c){this.trackEvent({category:"user_action",action:a,label:b,metadata:c})}trackError(a,b){d.captureException(a,{tags:{error_type:"application_error",user_role:this.userRole||"unknown"},extra:{...b,userId:this.userId,timestamp:new Date().toISOString()}})}trackFirebaseOperation(a,b,c,d){this.trackPerformance({name:"firebase_operation",value:c,unit:"ms",tags:{operation:a,collection:b,success:d.toString()}})}trackMercadoPagoOperation(a,b,c){this.trackPerformance({name:"mercadopago_operation",value:b,unit:"ms",tags:{operation:a,success:c.toString()}})}setContext(a,b){d.setContext(a,b)}setTag(a,b){d.setTag(a,b)}startTransaction(a,b){return d.startSpan({name:a,op:b},()=>{})}captureMessage(a,b="info",c){d.withScope(e=>{e.setLevel(b),c&&e.setContext("extra",c),e.setTag("user_role",this.userRole||"unknown"),d.captureMessage(a)})}async flush(a=2e3){return d.flush(a)}}let i=h.getInstance()},42223:(a,b,c)=>{"use strict";c.d(b,{T:()=>d});class d{static{this.serviceWorkerRegistration=null}static{this.isInitialized=!1}static async initialize(){try{if(!("serviceWorker"in navigator))return console.warn("Service Workers not supported"),{permission:"denied",supported:!1,serviceWorkerRegistered:!1};if(!("Notification"in window))return console.warn("Notifications not supported"),{permission:"denied",supported:!1,serviceWorkerRegistered:!1};try{return this.serviceWorkerRegistration=await navigator.serviceWorker.register("/sw.js",{scope:"/"}),console.log("Service Worker registered successfully:",this.serviceWorkerRegistration),await navigator.serviceWorker.ready,this.isInitialized=!0,navigator.serviceWorker.addEventListener("message",this.handleServiceWorkerMessage),{permission:Notification.permission,supported:!0,serviceWorkerRegistered:!0}}catch(a){return console.error("Service Worker registration failed:",a),{permission:Notification.permission,supported:!0,serviceWorkerRegistered:!1}}}catch(a){return console.error("Error initializing push notifications:",a),{permission:"denied",supported:!1,serviceWorkerRegistered:!1}}}static async requestPermission(){try{if(!("Notification"in window))return console.warn("Notifications not supported"),"denied";if("granted"===Notification.permission)return"granted";if("denied"===Notification.permission)return console.warn("Notification permission denied by user"),"denied";let a=await Notification.requestPermission();return console.log("Notification permission:",a),a}catch(a){return console.error("Error requesting notification permission:",a),"denied"}}static async showLocalNotification(a,b={}){try{if(!("Notification"in window))return void console.warn("Notifications not supported");if("granted"!==Notification.permission)return void console.warn("Notification permission not granted");let c={icon:"/icon-192x192.png",badge:"/icon-96x96.png",vibrate:[200,100,200],requireInteraction:!1,...b},d=new Notification(a,c);c.requireInteraction||setTimeout(()=>{d.close()},8e3),d.onclick=a=>{a.preventDefault(),d.close(),b.data&&b.data.url?(window.focus(),window.location.href=b.data.url):window.focus()}}catch(a){console.error("Error showing local notification:",a)}}static async showServiceWorkerNotification(a,b={}){try{if(!this.serviceWorkerRegistration)return console.warn("Service Worker not registered, falling back to local notification"),this.showLocalNotification(a,b);await this.serviceWorkerRegistration.showNotification(a,{icon:"/icon-192x192.png",badge:"/icon-96x96.png",vibrate:[200,100,200],requireInteraction:!1,...b})}catch(c){return console.error("Error showing service worker notification:",c),this.showLocalNotification(a,b)}}static async showOrderNotification(a){try{if("granted"!==Notification.permission)return void console.warn("Notification permission not granted");let b="Moai - Actualizaci\xf3n de Pedido",c="Tu pedido ha sido actualizado",d="/icon-192x192.png",e=!1,f=[200,100,200],g=[];switch(a.orderStatus){case"accepted":b="âœ… Pedido Confirmado",c=`Tu pedido #${a.orderId.slice(-8)} ha sido confirmado${a.cookerName?` por ${a.cookerName}`:""}`,d="/notifications/accepted.png",g=[{action:"view",title:"Ver Pedido"}];break;case"preparing":b="\uD83D\uDC68â€\uD83C\uDF73 Preparando tu Pedido",c=`${a.cookerName||"El cocinero"} est\xe1 preparando tu pedido. \xa1Ya casi est\xe1 listo!`,d="/notifications/preparing.png",g=[{action:"track",title:"Ver Progreso"}];break;case"ready":b="\uD83C\uDF7Dï¸ \xa1Pedido Listo!",c="Tu comida est\xe1 lista. Buscando conductor para la entrega.",d="/notifications/ready.png",f=[300,100,300,100,300],e=!0;break;case"delivering":b="\uD83D\uDE97 Conductor Asignado",c=`${a.driverName||"Un conductor"} est\xe1 en camino con tu pedido${a.eta?`. ETA: ${a.eta}`:""}`,d="/notifications/delivering.png",g=[{action:"track",title:"Seguir en Tiempo Real"}],f=[200,100,200],e=!0;break;case"delivered":b="\uD83C\uDF89 \xa1Pedido Entregado!",c="\xa1Disfruta tu comida! No olvides calificar tu experiencia.",d="/notifications/delivered.png",g=[{action:"rate",title:"Calificar"}],f=[300,100,300,100,300,100,300],e=!0;break;case"cancelled":b="âŒ Pedido Cancelado",c="Tu pedido ha sido cancelado. Te reembolsaremos el dinero.",d="/notifications/cancelled.png",g=[{action:"support",title:"Contactar Soporte"}];break;default:c=a.message||"Tu pedido ha sido actualizado"}let h={body:c,icon:d,badge:"/icon-96x96.png",vibrate:f,requireInteraction:e,actions:g,data:{orderId:a.orderId,orderStatus:a.orderStatus,url:a.url||`/orders/${a.orderId}/tracking`,timestamp:Date.now()},tag:`order-${a.orderId}`,renotify:!0};this.serviceWorkerRegistration?await this.showServiceWorkerNotification(b,h):await this.showLocalNotification(b,h)}catch(a){console.error("Error showing order notification:",a)}}static getPermissionStatus(){return{permission:"Notification"in window?Notification.permission:"denied",supported:"Notification"in window&&"serviceWorker"in navigator,serviceWorkerRegistered:!!this.serviceWorkerRegistration}}static async showTestNotification(){await this.showOrderNotification({orderId:"test-order-123",orderStatus:"delivering",driverName:"Juan P\xe9rez",eta:"15 min",message:"Esta es una notificaci\xf3n de prueba"})}static{this.handleServiceWorkerMessage=a=>{console.log("Received message from service worker:",a.data),a.data&&"NOTIFICATION_CLICKED"===a.data.type&&console.log("Notification was clicked:",a.data)}}static cleanup(){"serviceWorker"in navigator&&navigator.serviceWorker.removeEventListener("message",this.handleServiceWorkerMessage)}static async setNotificationsEnabled(a){try{localStorage.setItem("moai-notifications-enabled",a.toString()),a&&"granted"!==Notification.permission&&await this.requestPermission(),console.log("Notifications",a?"enabled":"disabled")}catch(a){console.error("Error setting notification preference:",a)}}static areNotificationsEnabled(){let a=localStorage.getItem("moai-notifications-enabled");return null===a||"true"===a}}},44092:(a,b,c)=>{"use strict";c.d(b,{a:()=>g,u:()=>h});var d=c(43210),e=c(21295);c(87675);var f=c(42223);function g(a={}){let{user:b}=(0,e.A)(),{enabled:h=!0,enabledStatuses:i=["accepted","preparing","ready","delivering","delivered","cancelled"]}=a;(0,d.useRef)(new Map),(0,d.useRef)(null);let j=(0,d.useRef)(!0);return(0,d.useCallback)(async a=>{try{if(!h||!f.T.areNotificationsEnabled()||!i.includes(a.newStatus)||j.current||a.oldStatus===a.newStatus)return;console.log("Order status changed:",a);let b="",d="",e="";if(a.order.cookerId)try{let d=await Promise.resolve().then(c.bind(c,87675)).then(({CooksService:b})=>b.getCookById(a.order.cookerId));b=d?.displayName||""}catch(a){console.error("Error getting cooker name:",a)}if("delivering"===a.newStatus&&a.order.driverId)try{let[b,f]=await Promise.all([Promise.resolve().then(c.bind(c,87675)).then(({DriversService:b})=>b.getDriverById(a.order.driverId)),c.e(8413).then(c.bind(c,18413)).then(({DeliveryTrackingService:b})=>new Promise(c=>{let d=b.subscribeToDeliveryTracking(a.orderId,a=>{d(),c(a)})}))]);d=b?.displayName||"",e=f?.estimatedDeliveryTime||""}catch(a){console.error("Error getting driver data:",a)}await f.T.showOrderNotification({orderId:a.orderId,orderStatus:a.newStatus,cookerName:b,driverName:d,eta:e,url:`/orders/${a.orderId}/tracking`})}catch(a){console.error("Error handling order status change:",a)}},[h,i]),{showTestNotification:()=>f.T.showTestNotification(),requestPermission:()=>f.T.requestPermission(),getPermissionStatus:()=>f.T.getPermissionStatus(),showOrderNotification:(a,b,c)=>f.T.showOrderNotification({orderId:a,orderStatus:b,...c})}}function h(a,b=!0){let c=(0,d.useRef)(!1);return{resetArrivedNotification:()=>{c.current=!1}}}},44493:(a,b,c)=>{"use strict";c.d(b,{ErrorBoundary:()=>e});var d=c(61369);let e=(0,d.registerClientReference)(function(){throw Error("Attempted to call ErrorBoundary() from the server but ErrorBoundary is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"D:\\Moai\\moai-app\\components\\ErrorBoundary.tsx","ErrorBoundary");(0,d.registerClientReference)(function(){throw Error("Attempted to call useErrorReporting() from the server but useErrorReporting is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"D:\\Moai\\moai-app\\components\\ErrorBoundary.tsx","useErrorReporting"),(0,d.registerClientReference)(function(){throw Error("Attempted to call withErrorBoundary() from the server but withErrorBoundary is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"D:\\Moai\\moai-app\\components\\ErrorBoundary.tsx","withErrorBoundary")},46076:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>d});let d=(0,c(61369).registerClientReference)(function(){throw Error("Attempted to call the default export of \"D:\\\\Moai\\\\moai-app\\\\app\\\\global-error.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"D:\\Moai\\moai-app\\app\\global-error.tsx","default")},46672:(a,b,c)=>{"use strict";c.d(b,{ChatService:()=>f});var d=c(75535),e=c(56525);class f{static{this.MESSAGES_COLLECTION="chatMessages"}static{this.ROOMS_COLLECTION="chatRooms"}static async createChatRoom(a,b,c,f){try{if(!a||0===a.length)return console.error("Cannot create chat room: no participants provided"),null;console.log("Creating chat room with participants:",a);let g={participants:a,participantDetails:b,type:c,orderId:f,createdAt:(0,d.O5)(),updatedAt:(0,d.O5)(),status:"active",unreadCount:a.reduce((a,b)=>(a[b]=0,a),{})},h=await (0,d.gS)((0,d.collection)(e.db,this.ROOMS_COLLECTION),g);return console.log("Chat room created with ID:",h.id),h.id}catch(a){return console.error("Error creating chat room:",a),a instanceof Error&&console.error("Error details:",a.message),null}}static async getOrCreateOrderChatRoom(a,b,c,f){try{console.log("Getting or creating chat room for order:",a,"participants:",{cookerId:b,customerId:c,driverId:f});let g=(0,d.query)((0,d.collection)(e.db,this.ROOMS_COLLECTION),(0,d.where)("type","==","order"),(0,d.where)("orderId","==",a)),h=await (0,d.getDocs)(g);if(!h.empty)return console.log("Chat room already exists for order:",a),h.docs[0].id;if(!b||!c)return console.error("Cannot create chat room: missing required participants (cookerId or customerId)"),null;let i=[b,c];f&&i.push(f);let j={};for(let a of i)try{let b=await (0,d.getDoc)((0,d.doc)(e.db,"users",a));if(b.exists()){let c=b.data();j[a]={name:c.displayName||c.email||"Usuario",role:c.role?.toLowerCase()||"customer",avatar:c.photoURL||c.avatar}}else console.warn(`User document not found for ${a}, using default details`),j[a]={name:"Usuario",role:"customer"}}catch(b){console.warn(`Could not load details for user ${a}:`,b),j[a]={name:"Usuario",role:"customer"}}return await this.createChatRoom(i,j,"order",a)}catch(a){return console.error("Error getting or creating order chat room:",a),null}}static async sendMessage(a,b,c,f="text",g){try{let h=await (0,d.getDoc)((0,d.doc)(e.db,"users",b)),i=h.exists()?h.data():{},j={senderId:b,senderName:i.displayName||i.email||"Usuario",senderRole:i.role?.toLowerCase()||"customer",senderAvatar:i.photoURL||i.avatar,message:c,timestamp:(0,d.O5)(),type:f,metadata:g,readBy:[b]};await (0,d.gS)((0,d.collection)(e.db,this.ROOMS_COLLECTION,a,this.MESSAGES_COLLECTION),j),await (0,d.mZ)((0,d.doc)(e.db,this.ROOMS_COLLECTION,a),{lastMessage:{message:c,senderId:b,timestamp:(0,d.O5)(),type:f},updatedAt:(0,d.O5)(),[`unreadCount.${b}`]:0});let k=await (0,d.getDoc)((0,d.doc)(e.db,this.ROOMS_COLLECTION,a));if(k.exists()){let c=k.data(),f={};c.participants.forEach(a=>{a!==b&&(f[`unreadCount.${a}`]=(c.unreadCount[a]||0)+1)}),Object.keys(f).length>0&&await (0,d.mZ)((0,d.doc)(e.db,this.ROOMS_COLLECTION,a),f)}return console.log("Message sent successfully"),!0}catch(a){return console.error("Error sending message:",a),!1}}static async sendSystemMessage(a,b,c){try{let f={senderId:"system",senderName:"Sistema",senderRole:"admin",message:b,timestamp:(0,d.O5)(),type:"system",metadata:c,readBy:[]};return await (0,d.gS)((0,d.collection)(e.db,this.ROOMS_COLLECTION,a,this.MESSAGES_COLLECTION),f),await (0,d.mZ)((0,d.doc)(e.db,this.ROOMS_COLLECTION,a),{lastMessage:{message:b,senderId:"system",timestamp:(0,d.O5)(),type:"system"},updatedAt:(0,d.O5)()}),!0}catch(a){return console.error("Error sending system message:",a),!1}}static async markMessagesAsRead(a,b){try{return await (0,d.mZ)((0,d.doc)(e.db,this.ROOMS_COLLECTION,a),{[`unreadCount.${b}`]:0,[`participantDetails.${b}.lastSeen`]:(0,d.O5)()}),!0}catch(a){return console.error("Error marking messages as read:",a),!1}}static subscribeToMessages(a,b){let c=(0,d.query)((0,d.collection)(e.db,this.ROOMS_COLLECTION,a,this.MESSAGES_COLLECTION),(0,d.orderBy)("timestamp","asc"),(0,d.limit)(100));return(0,d.aQ)(c,a=>{b(a.docs.map(a=>({id:a.id,...a.data()})))})}static subscribeToUserChatRooms(a,b){let c=(0,d.query)((0,d.collection)(e.db,this.ROOMS_COLLECTION),(0,d.where)("participants","array-contains",a),(0,d.where)("status","==","active"),(0,d.orderBy)("updatedAt","desc"));return(0,d.aQ)(c,a=>{b(a.docs.map(a=>({id:a.id,...a.data()})))})}static async getTotalUnreadCount(a){try{let b=(0,d.query)((0,d.collection)(e.db,this.ROOMS_COLLECTION),(0,d.where)("participants","array-contains",a),(0,d.where)("status","==","active")),c=await (0,d.getDocs)(b),f=0;return c.docs.forEach(b=>{let c=b.data();f+=c.unreadCount[a]||0}),f}catch(a){return console.error("Error getting total unread count:",a),0}}static async archiveChatRoom(a){try{return await (0,d.mZ)((0,d.doc)(e.db,this.ROOMS_COLLECTION,a),{status:"archived",updatedAt:(0,d.O5)()}),!0}catch(a){return console.error("Error archiving chat room:",a),!1}}static async sendLocationMessage(a,b,c){return await this.sendMessage(a,b,`ğŸ“ Ubicaci\xf3n compartida: ${c.address}`,"location",{location:c})}static async sendOrderUpdateMessage(a,b,c,d){let e={accepted:"âœ… Pedido aceptado y en preparaci\xf3n",preparing:"\uD83D\uDC68â€\uD83C\uDF73 Preparando tu pedido...",ready:"\uD83D\uDCE6 \xa1Pedido listo para recoger!",delivering:"\uD83D\uDE9A Pedido en camino",delivered:"\uD83C\uDF89 \xa1Pedido entregado!"}[c]||`Estado actualizado: ${c}`;return await this.sendSystemMessage(a,e,{orderId:b})}}},47136:(a,b,c)=>{"use strict";c.d(b,{default:()=>d});let d=(0,c(61369).registerClientReference)(function(){throw Error("Attempted to call the default export of \"D:\\\\Moai\\\\moai-app\\\\context\\\\AuthHandler.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"D:\\Moai\\moai-app\\context\\AuthHandler.tsx","default")},50472:(a,b,c)=>{"use strict";c.d(b,{default:()=>d});let d=(0,c(61369).registerClientReference)(function(){throw Error("Attempted to call the default export of \"D:\\\\Moai\\\\moai-app\\\\components\\\\ChatNotificationHandler.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"D:\\Moai\\moai-app\\components\\ChatNotificationHandler.tsx","default")},52140:(a,b,c)=>{"use strict";c.d(b,{default:()=>f}),c(43210);var d=c(21295),e=c(44092);function f(){let{user:a}=(0,d.A)();return(0,e.a)({enabled:!!a,enabledStatuses:["accepted","preparing","ready","delivering","delivered"]}),null}},53960:(a,b,c)=>{"use strict";c.d(b,{default:()=>d});let d=(0,c(61369).registerClientReference)(function(){throw Error("Attempted to call the default export of \"D:\\\\Moai\\\\moai-app\\\\components\\\\chat\\\\FloatingChatButton.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"D:\\Moai\\moai-app\\components\\chat\\FloatingChatButton.tsx","default")},54858:(a,b,c)=>{"use strict";c.d(b,{Y:()=>g,q:()=>h});var d=c(43210),e=c(46672),f=c(21295);function g(){let{user:a}=(0,f.A)(),[b,c]=(0,d.useState)([]),[g,h]=(0,d.useState)(0),[i,j]=(0,d.useState)(!0);return{rooms:b,totalUnreadCount:g,loading:i,createOrderChat:async(a,b,c,d)=>await e.ChatService.getOrCreateOrderChatRoom(a,b,c,d),markRoomAsRead:async b=>{if(a)return await e.ChatService.markMessagesAsRead(b,a.uid)},sendMessage:async(b,c)=>!!a&&await e.ChatService.sendMessage(b,a.uid,c),sendLocationMessage:async(b,c)=>!!a&&await e.ChatService.sendLocationMessage(b,a.uid,c),sendOrderUpdate:async(a,b,c,d)=>await e.ChatService.sendOrderUpdateMessage(a,b,c,d),archiveRoom:async a=>await e.ChatService.archiveChatRoom(a)}}function h(){let{totalUnreadCount:a}=g();return{totalUnreadCount:a}}},55192:(a,b,c)=>{"use strict";c.d(b,{BT:()=>j,Wu:()=>k,ZB:()=>i,Zp:()=>g,aR:()=>h});var d=c(60687),e=c(43210),f=c(96241);let g=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("div",{ref:c,className:(0,f.cn)("rounded-lg border bg-card text-card-foreground shadow-sm transition-all duration-300 hover:shadow-lg",a),...b}));g.displayName="Card";let h=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("div",{ref:c,className:(0,f.cn)("flex flex-col space-y-1.5 p-6",a),...b}));h.displayName="CardHeader";let i=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("h3",{ref:c,className:(0,f.cn)("text-2xl font-semibold leading-none tracking-tight",a),...b}));i.displayName="CardTitle";let j=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("p",{ref:c,className:(0,f.cn)("text-sm text-muted-foreground",a),...b}));j.displayName="CardDescription";let k=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("div",{ref:c,className:(0,f.cn)("p-6 pt-0",a),...b}));k.displayName="CardContent",e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("div",{ref:c,className:(0,f.cn)("flex items-center p-6 pt-0",a),...b})).displayName="CardFooter"},56525:(a,b,c)=>{"use strict";let d;c.d(b,{db:()=>i,j:()=>h,y:()=>d});var e=c(67989),f=c(61448),g=c(75535);d=(0,e.Dk)().length?(0,e.Dk)()[0]:(0,e.Wp)({apiKey:"AIzaSyBptLm3y63BDBH9Xgt_UY40ZjsgUvMOKGI",authDomain:"hometaste-tlpog.firebaseapp.com",projectId:"hometaste-tlpog",storageBucket:"hometaste-tlpog.firebasestorage.app",messagingSenderId:"72297856520",appId:"1:72297856520:web:c7d851e4c00c67ec419bbd"});let h=(0,f.xI)(d),i=(0,g.aU)(d)},59461:(a,b,c)=>{Promise.resolve().then(c.t.bind(c,86346,23)),Promise.resolve().then(c.t.bind(c,27924,23)),Promise.resolve().then(c.t.bind(c,40099,23)),Promise.resolve().then(c.t.bind(c,38243,23)),Promise.resolve().then(c.t.bind(c,28827,23)),Promise.resolve().then(c.t.bind(c,62763,23)),Promise.resolve().then(c.t.bind(c,97173,23)),Promise.resolve().then(c.bind(c,25587))},59821:(a,b,c)=>{"use strict";c.d(b,{E:()=>h});var d=c(60687);c(43210);var e=c(24224),f=c(96241);let g=(0,e.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function h({className:a,variant:b,...c}){return(0,d.jsx)("div",{className:(0,f.cn)(g({variant:b}),a),...c})}},62087:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>v,metadata:()=>t,viewport:()=>u});var d=c(37413),e=c(61421),f=c.n(e);c(82704);var g=c(73549),h=c(74237),i=c(20253),j=c(3465),k=c(47136),l=c(80363),m=c(81834),n=c(53960),o=c(50472);function p(){return(0,d.jsx)("script",{dangerouslySetInnerHTML:{__html:`
          (function() {
            try {
              const theme = localStorage.getItem('moai-theme') || 'system';
              const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
              const resolvedTheme = theme === 'system' ? systemTheme : theme;
              
              if (resolvedTheme === 'dark') {
                document.documentElement.classList.add('dark');
              } else {
                document.documentElement.classList.remove('dark');
              }
            } catch (e) {}
          })();
        `}})}var q=c(23856),r=c(70465),s=c(44493);let t={title:"Lican\xd1am",description:"Descubre deliciosa comida casera de cocineros locales",icons:{icon:"/llama-icon.jpg",apple:"/llama-icon.jpg"},manifest:"/manifest.json"},u={width:"device-width",initialScale:1,maximumScale:5,themeColor:"#FF6600"};function v({children:a}){return(0,d.jsxs)("html",{lang:"en",suppressHydrationWarning:!0,children:[(0,d.jsx)("head",{children:(0,d.jsx)(p,{})}),(0,d.jsx)("body",{className:f().className,suppressHydrationWarning:!0,children:(0,d.jsx)(s.ErrorBoundary,{children:(0,d.jsx)(j.ThemeProvider,{children:(0,d.jsx)(g.AuthProvider,{children:(0,d.jsx)(i.UserProfileProvider,{children:(0,d.jsxs)(h.CartProvider,{children:[(0,d.jsx)(r.default,{}),(0,d.jsx)(m.default,{}),(0,d.jsx)(o.default,{}),(0,d.jsx)(k.default,{children:a}),(0,d.jsx)(n.default,{}),(0,d.jsx)(q.SupportButton,{}),(0,d.jsx)(l.Toaster,{})]})})})})})})]})}},62151:(a,b,c)=>{Promise.resolve().then(c.bind(c,46076))},65541:(a,b,c)=>{Promise.resolve().then(c.t.bind(c,16444,23)),Promise.resolve().then(c.t.bind(c,16042,23)),Promise.resolve().then(c.t.bind(c,49477,23)),Promise.resolve().then(c.t.bind(c,29345,23)),Promise.resolve().then(c.t.bind(c,12089,23)),Promise.resolve().then(c.t.bind(c,46577,23)),Promise.resolve().then(c.t.bind(c,31307,23)),Promise.resolve().then(c.t.bind(c,14817,23))},68769:(a,b,c)=>{"use strict";c.d(b,{UserProfileProvider:()=>k,s:()=>l});var d=c(60687),e=c(43210),f=c(21295),g=c(56525),h=c(75535);class i{static{this.collection="userProfiles"}static async getUserProfile(a){try{let b=(0,h.doc)(g.db,this.collection,a),c=await (0,h.getDoc)(b);if(c.exists())return{id:c.id,...c.data()};return null}catch(a){return console.error("Error fetching user profile:",a),null}}static async createUserProfile(a,b,c){try{let d=h.Dc.now(),e={id:a,email:b,displayName:c,phone:"",address:{street:"",city:"Santiago",district:"",details:"",instructions:"",fullAddress:""},isProfileComplete:!1,createdAt:d,updatedAt:d},f=(0,h.doc)(g.db,this.collection,a);return await (0,h.BN)(f,e),e}catch(a){return console.error("Error creating user profile:",a),null}}static async updateUserProfile(a,b){try{let c=(0,h.doc)(g.db,this.collection,a),d=this.checkProfileComplete({phone:b.phone||"",address:b.address||{street:"",city:"",district:"",fullAddress:""}}),e={...b,isProfileComplete:d,updatedAt:h.Dc.now()};return b.address&&(e.address={...b.address,fullAddress:this.formatFullAddress(b.address)}),await (0,h.mZ)(c,e),!0}catch(a){return console.error("Error updating user profile:",a),!1}}static checkProfileComplete(a){return!!(a.phone&&a.address?.street&&a.address?.city&&a.address?.district)}static formatFullAddress(a){return[a.street,a.details,a.district,a.city].filter(Boolean).join(", ")}static async getOrCreateProfile(a,b,c){try{let d=await this.getUserProfile(a);return d||(d=await this.createUserProfile(a,b,c)),d}catch(a){return console.error("Error getting or creating user profile:",a),null}}static getChileanCommunes(){return["Las Condes","Providencia","Santiago","\xd1u\xf1oa","La Reina","Vitacura","Lo Barnechea","Macul","Pe\xf1alol\xe9n","La Florida","Puente Alto","Maip\xfa","Las Rozas","Quilicura","Huechuraba","Recoleta","Independencia","Conchal\xed","Renca","Quinta Normal","Estaci\xf3n Central","Cerrillos","Maip\xfa","Pudahuel","Lo Prado","Cerro Navia","San Miguel","San Joaqu\xedn","Pedro Aguirre Cerda","Lo Espejo","El Bosque","La Cisterna","San Ram\xf3n","La Granja","La Pintana"].sort()}static validateChileanPhone(a){let b=a.replace(/\D/g,"");return 11===b.length&&b.startsWith("569")||10===b.length&&b.startsWith("56")||9===b.length&&b.startsWith("9")||8===b.length&&b.startsWith("2")}static formatChileanPhone(a){let b=a.replace(/\D/g,"");return 9===b.length&&b.startsWith("9")||8===b.length&&b.startsWith("2")?`${b.slice(0,1)} ${b.slice(1,5)} ${b.slice(5)}`:a}}let j=(0,e.createContext)({profile:null,loading:!0,isProfileComplete:!1,updateProfile:async()=>!1,refreshProfile:async()=>{}}),k=({children:a})=>{let{user:b}=(0,f.A)(),[c,g]=(0,e.useState)(null),[h,k]=(0,e.useState)(!0);(0,e.useEffect)(()=>{b?l():(g(null),k(!1))},[b]);let l=async()=>{if(b){k(!0);try{let a=await i.getOrCreateProfile(b.uid,b.email||"",b.displayName||b.email||"Usuario");g(a)}catch(a){console.error("Error loading user profile:",a)}finally{k(!1)}}},m=async a=>{if(!b)return!1;try{let c=await i.updateUserProfile(b.uid,a);return c&&await n(),c}catch(a){return console.error("Error updating profile:",a),!1}},n=async()=>{b&&await l()},o=c?.isProfileComplete||!1;return(0,d.jsx)(j.Provider,{value:{profile:c,loading:h,isProfileComplete:o,updateProfile:m,refreshProfile:n},children:a})},l=()=>{let a=(0,e.useContext)(j);if(!a)throw Error("useUserProfile must be used within a UserProfileProvider");return a}},68988:(a,b,c)=>{"use strict";c.d(b,{p:()=>f});var d=c(60687);c(43210);var e=c(96241);function f({className:a,type:b,...c}){return(0,d.jsx)("input",{type:b,"data-slot":"input",className:(0,e.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",a),...c})}},69427:(a,b,c)=>{"use strict";function d(){return null}c.d(b,{default:()=>d}),c(43210),c(52581)},70373:(a,b,c)=>{"use strict";c.d(b,{BK:()=>h,eu:()=>g,q5:()=>i});var d=c(60687),e=c(43210),f=c(96241);let g=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("div",{ref:c,className:(0,f.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",a),...b}));g.displayName="Avatar";let h=e.forwardRef(({className:a,...b},c)=>{let[g,h]=e.useState(!1);return g||!b.src?null:(0,d.jsx)("img",{ref:c,className:(0,f.cn)("aspect-square h-full w-full object-cover",a),onError:()=>h(!0),...b})});h.displayName="AvatarImage";let i=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("div",{ref:c,className:(0,f.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted text-muted-foreground",a),...b}));i.displayName="AvatarFallback"},70465:(a,b,c)=>{"use strict";c.d(b,{default:()=>d});let d=(0,c(61369).registerClientReference)(function(){throw Error("Attempted to call the default export of \"D:\\\\Moai\\\\moai-app\\\\components\\\\ServiceWorkerRegistration.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"D:\\Moai\\moai-app\\components\\ServiceWorkerRegistration.tsx","default")},71423:(a,b,c)=>{"use strict";c.d(b,{CartProvider:()=>i,_:()=>j});var d=c(60687),e=c(43210),f=c(21295),g=c(87675);let h=(0,e.createContext)({items:[],itemCount:0,totalAmount:0,addToCart:()=>{},removeFromCart:()=>{},updateQuantity:()=>{},clearCart:()=>{},getCartSubtotal:()=>0,getDeliveryFee:()=>0,getServiceFee:()=>0,getTotal:()=>0}),i=({children:a})=>{let{user:b}=(0,f.A)(),[c,i]=(0,e.useState)([]),[j,k]=(0,e.useState)(null);(0,e.useEffect)(()=>{(async()=>{try{let a=await g.AppSettingsService.getSettings();k(a)}catch(a){console.error("Error loading app settings:",a),k({id:"main",deliveryFee:{baseRate:0,freeDeliveryThreshold:25e3,isEnabled:!1},serviceFee:{percentage:.12,isEnabled:!0},updatedAt:new Date,updatedBy:"system"})}})()},[]),(0,e.useEffect)(()=>{if(b){let a=localStorage.getItem(`cart_${b.uid}`);if(a)try{i(JSON.parse(a))}catch(a){console.error("Error loading cart from localStorage:",a)}}},[b]),(0,e.useEffect)(()=>{b&&localStorage.setItem(`cart_${b.uid}`,JSON.stringify(c))},[c,b]),(0,e.useEffect)(()=>{b||i([])},[b]);let l=a=>{i(b=>b.filter(b=>b.id!==a))},m=()=>c.reduce((a,b)=>a+b.totalPrice,0),n=()=>{if(!j||!j.deliveryFee.isEnabled)return 0;let a=m(),{baseRate:b,freeDeliveryThreshold:c}=j.deliveryFee;return a>=c?0:b},o=()=>j&&j.serviceFee.isEnabled?m()*j.serviceFee.percentage:0,p=()=>m()+n()+o(),q=c.reduce((a,b)=>a+b.quantity,0),r=p();return(0,d.jsx)(h.Provider,{value:{items:c,itemCount:q,totalAmount:r,addToCart:a=>{i(b=>{let c=b.findIndex(b=>b.dishId===a.dishId);if(!(c>=0))return[...b,{...a,id:`${a.dishId}_${Date.now()}`,totalPrice:a.price*a.quantity}];{let d=[...b];return d[c]={...d[c],quantity:d[c].quantity+a.quantity,totalPrice:(d[c].quantity+a.quantity)*d[c].price},d}})},removeFromCart:l,updateQuantity:(a,b)=>{if(b<=0)return void l(a);i(c=>c.map(c=>c.id===a?{...c,quantity:b,totalPrice:c.price*b}:c))},clearCart:()=>{i([]),b&&localStorage.removeItem(`cart_${b.uid}`)},getCartSubtotal:m,getDeliveryFee:n,getServiceFee:o,getTotal:p},children:a})},j=()=>{let a=(0,e.useContext)(h);if(!a)throw Error("useCart must be used within a CartProvider");return a}},71638:(a,b,c)=>{"use strict";c.d(b,{default:()=>h});var d=c(60687),e=c(43210),f=c(16189),g=c(21295);let h=({children:a})=>{let{user:b,role:c,loading:h}=(0,g.A)(),i=(0,f.useRouter)(),j=(0,f.usePathname)(),k=b?.email==="admin@moai.com"||b?.uid==="admin"||b?.email&&b.email.includes("admin");return(0,e.useEffect)(()=>{if(!h){if(console.log(`AuthHandler: user=${b?.email}, role=${c}, pathname=${j}, loading=${h}`),b&&k)return"/"===j?void i.push("/admin/dashboard"):void(j.startsWith("/admin")||c&&"Admin"!==c&&"admin"!==c&&("Client"===c&&(j.startsWith("/client")||j.startsWith("/dishes"))||"Cooker"===c&&j.startsWith("/cooker")||"Driver"===c&&j.startsWith("/driver")));if(!k&&j.startsWith("/admin"))return void i.push("/");if(b&&!c&&!k){"/"!==j&&"/login"!==j&&(console.log("User authenticated but no role found. Redirecting to home to complete registration."),i.push("/"));return}if(!b&&"/"!==j&&"/login"!==j)return void i.push("/");if(b&&c&&!k){if("/"===j){switch(console.log(`AuthHandler: Redirecting user with role ${c} from homepage`),c){case"Client":i.push("/dishes");break;case"Cooker":i.push("/cooker/dashboard");break;case"Driver":i.push("/driver/dashboard");break;default:console.log(`AuthHandler: Unknown role ${c}, defaulting to dishes`),i.push("/dishes")}return}if("Client"===c&&(j.startsWith("/client")||j.startsWith("/dishes")||"/cart"===j)||"Cooker"===c&&j.startsWith("/cooker")||"Driver"===c&&j.startsWith("/driver"))return;if("Client"===c&&(j.startsWith("/cooker")||j.startsWith("/driver"))||"Cooker"===c&&(j.startsWith("/client")||j.startsWith("/driver"))||"Driver"===c&&(j.startsWith("/client")||j.startsWith("/cooker")))switch(c){case"Client":i.push("/dishes");break;case"Cooker":i.push("/cooker/dashboard");break;case"Driver":i.push("/driver/dashboard")}}}},[b,c,h,i,j,k]),(0,d.jsx)(d.Fragment,{children:a})}},72720:a=>{function b(a){var b=Error("Cannot find module '"+a+"'");throw b.code="MODULE_NOT_FOUND",b}b.keys=()=>[],b.resolve=b,b.id=72720,a.exports=b},72938:(a,b,c)=>{"use strict";c.d(b,{default:()=>e});var d=c(54858);function e(){return(0,d.q)(),null}},73549:(a,b,c)=>{"use strict";c.d(b,{AuthProvider:()=>e});var d=c(61369);let e=(0,d.registerClientReference)(function(){throw Error("Attempted to call AuthProvider() from the server but AuthProvider is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"D:\\Moai\\moai-app\\context\\AuthContext.tsx","AuthProvider");(0,d.registerClientReference)(function(){throw Error("Attempted to call useAuth() from the server but useAuth is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"D:\\Moai\\moai-app\\context\\AuthContext.tsx","useAuth")},74237:(a,b,c)=>{"use strict";c.d(b,{CartProvider:()=>e});var d=c(61369);let e=(0,d.registerClientReference)(function(){throw Error("Attempted to call CartProvider() from the server but CartProvider is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"D:\\Moai\\moai-app\\context\\CartContext.tsx","CartProvider");(0,d.registerClientReference)(function(){throw Error("Attempted to call useCart() from the server but useCart is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"D:\\Moai\\moai-app\\context\\CartContext.tsx","useCart")},80363:(a,b,c)=>{"use strict";c.d(b,{Toaster:()=>d});let d=(0,c(61369).registerClientReference)(function(){throw Error("Attempted to call Toaster() from the server but Toaster is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"D:\\Moai\\moai-app\\components\\ui\\sonner.tsx","Toaster")},81834:(a,b,c)=>{"use strict";c.d(b,{default:()=>d});let d=(0,c(61369).registerClientReference)(function(){throw Error("Attempted to call the default export of \"D:\\\\Moai\\\\moai-app\\\\components\\\\NotificationInitializer.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"D:\\Moai\\moai-app\\components\\NotificationInitializer.tsx","default")},82704:()=>{},83744:(a,b,c)=>{Promise.resolve().then(c.bind(c,39856)),Promise.resolve().then(c.bind(c,72938)),Promise.resolve().then(c.bind(c,93331)),Promise.resolve().then(c.bind(c,52140)),Promise.resolve().then(c.bind(c,69427)),Promise.resolve().then(c.bind(c,26542)),Promise.resolve().then(c.bind(c,94593)),Promise.resolve().then(c.bind(c,21295)),Promise.resolve().then(c.bind(c,71638)),Promise.resolve().then(c.bind(c,71423)),Promise.resolve().then(c.bind(c,68769)),Promise.resolve().then(c.bind(c,40303))},87675:(a,b,c)=>{"use strict";c.r(b),c.d(b,{AdminService:()=>k,AnalyticsService:()=>m,AppSettingsService:()=>l,CooksService:()=>g,DishesService:()=>f,DriversService:()=>j,OrdersService:()=>h,ReviewsService:()=>i});var d=c(75535),e=c(56525);class f{static{this.collection="dishes"}static async getAllDishes(){try{return(await (0,d.getDocs)((0,d.query)((0,d.collection)(e.db,this.collection),(0,d.orderBy)("createdAt","desc")))).docs.map(a=>({id:a.id,...a.data()}))}catch(a){return console.error("Error fetching dishes with orderBy, trying fallback:",a),this.getAllDishesFallback()}}static async getAllDishesFallback(){try{return(await (0,d.getDocs)((0,d.collection)(e.db,this.collection))).docs.map(a=>({id:a.id,...a.data()})).sort((a,b)=>{let c=a.createdAt?.toMillis()||0;return(b.createdAt?.toMillis()||0)-c})}catch(a){return console.error("Error fetching dishes (fallback):",a),[]}}static async getDishesByCategory(a){try{return(await (0,d.getDocs)((0,d.query)((0,d.collection)(e.db,this.collection),(0,d.where)("category","==",a),(0,d.where)("isAvailable","==",!0),(0,d.orderBy)("rating","desc")))).docs.map(a=>({id:a.id,...a.data()}))}catch(b){return console.error("Error fetching dishes by category with index, trying fallback:",b),this.getDishesByCategoryFallback(a)}}static async getDishesByCategoryFallback(a){try{return(await (0,d.getDocs)((0,d.collection)(e.db,this.collection))).docs.map(a=>({id:a.id,...a.data()})).filter(b=>b.category===a&&b.isAvailable).sort((a,b)=>(b.rating||0)-(a.rating||0))}catch(a){return console.error("Error fetching dishes by category (fallback):",a),[]}}static async getDishesByCook(a){try{return(await (0,d.getDocs)((0,d.query)((0,d.collection)(e.db,this.collection),(0,d.where)("cookerId","==",a),(0,d.orderBy)("createdAt","desc")))).docs.map(a=>({id:a.id,...a.data()}))}catch(b){return console.warn("Database index is building, using temporary fallback method..."),this.getDishesByCookFallback(a)}}static async getDishesByCookFallback(a){try{try{return(await (0,d.getDocs)((0,d.query)((0,d.collection)(e.db,this.collection),(0,d.where)("cookerId","==",a)))).docs.map(a=>({id:a.id,...a.data()})).sort((a,b)=>{let c=a.createdAt?.toMillis()||0;return(b.createdAt?.toMillis()||0)-c})}catch(b){return console.warn("Simple query failed, using full collection scan..."),(await (0,d.getDocs)((0,d.collection)(e.db,this.collection))).docs.map(a=>({id:a.id,...a.data()})).filter(b=>b.cookerId===a).sort((a,b)=>{let c=a.createdAt?.toMillis()||0;return(b.createdAt?.toMillis()||0)-c})}}catch(a){return console.error("Error fetching dishes by cook (fallback):",a),[]}}static async getDishById(a){try{let b=(0,d.doc)(e.db,this.collection,a),c=await (0,d.getDoc)(b);if(c.exists())return{id:c.id,...c.data()};return null}catch(a){return console.error("Error fetching dish:",a),null}}static async createDish(a){try{let b=d.Dc.now();return(await (0,d.gS)((0,d.collection)(e.db,this.collection),{...a,createdAt:b,updatedAt:b})).id}catch(a){return console.error("Error creating dish:",a),null}}static async updateDish(a,b){try{let c=(0,d.doc)(e.db,this.collection,a);return await (0,d.mZ)(c,{...b,updatedAt:d.Dc.now()}),!0}catch(a){return console.error("Error updating dish:",a),!1}}static async deleteDish(a){try{return await (0,d.kd)((0,d.doc)(e.db,this.collection,a)),!0}catch(a){return console.error("Error deleting dish:",a),!1}}static async searchDishes(a){try{return(await (0,d.getDocs)((0,d.collection)(e.db,this.collection))).docs.map(a=>({id:a.id,...a.data()})).filter(b=>b.name.toLowerCase().includes(a.toLowerCase())||b.description.toLowerCase().includes(a.toLowerCase())||b.tags.some(b=>b.toLowerCase().includes(a.toLowerCase()))||b.cookerName.toLowerCase().includes(a.toLowerCase()))}catch(a){return console.error("Error searching dishes:",a),[]}}static async getUserFavorites(a){try{let b=await (0,d.getDoc)((0,d.doc)(e.db,"favorites",a));if(b.exists())return b.data().dishIds||[];return[]}catch(a){return console.error("Error fetching user favorites:",a),[]}}static async addToFavorites(a,b){try{let c=(0,d.doc)(e.db,"favorites",a),f=await (0,d.getDoc)(c);if(f.exists()){let a=f.data().dishIds||[];a.includes(b)||await (0,d.mZ)(c,{dishIds:[...a,b],updatedAt:d.Dc.now()})}else await (0,d.BN)(c,{dishIds:[b],createdAt:d.Dc.now(),updatedAt:d.Dc.now()});return!0}catch(a){return console.error("Error adding to favorites:",a),!1}}static async removeFromFavorites(a,b){try{let c=(0,d.doc)(e.db,"favorites",a),f=await (0,d.getDoc)(c);if(f.exists()){let a=(f.data().dishIds||[]).filter(a=>a!==b);await (0,d.mZ)(c,{dishIds:a,updatedAt:d.Dc.now()})}return!0}catch(a){return console.error("Error removing from favorites:",a),!1}}}class g{static{this.collection="cooks"}static async getAllCooks(){try{return(await (0,d.getDocs)((0,d.query)((0,d.collection)(e.db,this.collection),(0,d.orderBy)("rating","desc")))).docs.map(a=>({id:a.id,...a.data()}))}catch(a){return console.error("Error fetching cooks:",a),[]}}static async getCookById(a){try{let b=(0,d.doc)(e.db,this.collection,a),c=await (0,d.getDoc)(b);if(c.exists())return{id:c.id,...c.data()};return null}catch(a){return console.error("Error fetching cook:",a),null}}static async updateCookProfile(a,b){try{let c=(0,d.doc)(e.db,this.collection,a);return await (0,d.mZ)(c,{...b,updatedAt:d.Dc.now()}),!0}catch(a){return console.error("Error updating cook profile:",a),!1}}static async createCookProfile(a){try{let b=d.Dc.now();return(await (0,d.gS)((0,d.collection)(e.db,this.collection),{...a,createdAt:b,updatedAt:b})).id}catch(a){return console.error("Error creating cook profile:",a),null}}static async createCookProfileWithId(a,b){try{let c=d.Dc.now(),f=(0,d.doc)(e.db,this.collection,a);return await (0,d.BN)(f,{...b,createdAt:c,updatedAt:c}),!0}catch(a){return console.error("Error creating cook profile with ID:",a),!1}}}class h{static{this.collection="orders"}static async getAllOrders(){try{return(await (0,d.getDocs)((0,d.query)((0,d.collection)(e.db,this.collection),(0,d.orderBy)("createdAt","desc")))).docs.map(a=>({id:a.id,...a.data()}))}catch(a){return console.error("Error fetching all orders:",a),[]}}static async getOrdersByCustomer(a){try{return(await (0,d.getDocs)((0,d.query)((0,d.collection)(e.db,this.collection),(0,d.where)("customerId","==",a),(0,d.orderBy)("createdAt","desc")))).docs.map(a=>({id:a.id,...a.data()}))}catch(a){return console.error("Error fetching customer orders:",a),[]}}static async getOrdersByCook(a){try{return(await (0,d.getDocs)((0,d.query)((0,d.collection)(e.db,this.collection),(0,d.where)("cookerId","==",a),(0,d.orderBy)("createdAt","desc")))).docs.map(a=>({id:a.id,...a.data()}))}catch(a){return console.error("Error fetching cook orders:",a),[]}}static async getOrderById(a){try{let b=(0,d.doc)(e.db,this.collection,a),c=await (0,d.getDoc)(b);if(c.exists())return{id:c.id,...c.data()};return null}catch(a){return console.error("Error fetching order by ID:",a),null}}static async createOrder(a){try{let b=d.Dc.now(),{generateDeliveryCode:f}=await Promise.resolve().then(c.bind(c,96241)),h=await (0,d.gS)((0,d.collection)(e.db,this.collection),{...a,deliveryCode:a.deliveryCode||f(),isDelivered:!1,createdAt:b,updatedAt:b});try{let d=await g.getCookById(a.cookerId);if(d&&d.email){let{EmailService:e}=await c.e(4138).then(c.bind(c,94138)),f={id:h.id,...a,createdAt:b,updatedAt:b};await e.sendOrderNotificationToCook(f,d),console.log(`Email notification sent to cook ${d.email} for order ${h.id}`)}}catch(a){console.error("Error sending email notification to cook:",a)}try{let{ChatService:b}=await Promise.resolve().then(c.bind(c,46672));await b.getOrCreateOrderChatRoom(h.id,a.cookerId,a.customerId,a.driverId)}catch(a){console.warn("Could not create chat room for order:",a)}return h.id}catch(a){return console.error("Error creating order:",a),null}}static async updateOrderStatus(a,b,f){try{let g=(0,d.doc)(e.db,this.collection,a),h={status:b,updatedAt:d.Dc.now()};if("delivered"===b?(h.actualDeliveryTime=d.Dc.now(),h.isDelivered=!0):"ready"===b?(h.availableForPickup=!0,h.readyTime=d.Dc.now()):"delivering"===b&&f?.userId&&(h.driverId=f.userId,h.pickupTime=d.Dc.now()),await (0,d.mZ)(g,h),f&&["accepted","preparing","ready","delivering","delivered"].includes(b))try{let{ChatService:e}=await Promise.resolve().then(c.bind(c,46672)),h=await (0,d.getDoc)(g);if(h.exists()){let c=h.data(),d=await e.getOrCreateOrderChatRoom(a,c.cookerId,c.customerId,c.driverId);d&&await e.sendOrderUpdateMessage(d,a,b,f.role)}}catch(a){console.warn("Could not send chat notification for status update:",a)}return!0}catch(a){return console.error("Error updating order status:",a),!1}}static async updateOrder(a,b){try{let c=(0,d.doc)(e.db,this.collection,a);return await (0,d.mZ)(c,{...b,updatedAt:d.Dc.now()}),!0}catch(a){return console.error("Error updating order:",a),!1}}static async verifyDeliveryCode(a,b){try{let c=(0,d.doc)(e.db,this.collection,a),f=await (0,d.getDoc)(c);if(!f.exists())return{success:!1,message:"Pedido no encontrado"};let g=f.data();if(g.isDelivered)return{success:!1,message:"Este pedido ya fue entregado"};if("delivering"!==g.status)return{success:!1,message:"Este pedido no est\xe1 en estado de entrega"};if(g.deliveryCode!==b)return{success:!1,message:"C\xf3digo de entrega incorrecto"};return await (0,d.mZ)(c,{status:"delivered",isDelivered:!0,actualDeliveryTime:d.Dc.now(),updatedAt:d.Dc.now()}),{success:!0,message:"Pedido entregado exitosamente"}}catch(a){return console.error("Error verifying delivery code:",a),{success:!1,message:"Error al verificar el c\xf3digo"}}}static async getOrderByDeliveryCode(a){try{let b=await (0,d.getDocs)((0,d.query)((0,d.collection)(e.db,this.collection),(0,d.where)("deliveryCode","==",a),(0,d.where)("status","==","delivering"),(0,d.where)("isDelivered","==",!1)));if(b.empty)return null;let c=b.docs[0];return{id:c.id,...c.data()}}catch(a){return console.error("Error finding order by delivery code:",a),null}}static async getAvailableOrdersForDelivery(){try{return(await (0,d.getDocs)((0,d.query)((0,d.collection)(e.db,this.collection),(0,d.where)("status","in",["accepted","preparing","ready"]),(0,d.orderBy)("createdAt","asc")))).docs.map(a=>({id:a.id,...a.data()}))}catch(a){return console.error("Error fetching available orders:",a),[]}}static async assignOrderToDriver(a,b){try{let c=(0,d.doc)(e.db,this.collection,a);return await (0,d.mZ)(c,{driverId:b,status:"delivering",pickupTime:d.Dc.now(),updatedAt:d.Dc.now()}),!0}catch(a){return console.error("Error assigning order to driver:",a),!1}}static async getReadyOrdersForPickup(){try{return(await (0,d.getDocs)((0,d.query)((0,d.collection)(e.db,this.collection),(0,d.where)("status","==","ready")))).docs.map(a=>({id:a.id,...a.data()}))}catch(a){return console.error("Error fetching ready orders:",a),[]}}static subscribeToAvailableOrders(a){let b=(0,d.query)((0,d.collection)(e.db,this.collection),(0,d.where)("status","in",["pending","accepted","preparing","ready"]));return(0,d.aQ)(b,b=>{let c=b.docs.map(a=>({id:a.id,...a.data()}));c.sort((a,b)=>(a.createdAt?.toMillis()||0)-(b.createdAt?.toMillis()||0)),a(c)},b=>{console.error("Error in available orders subscription:",b),a([])})}static subscribeToOrderUpdates(a,b){let c=(0,d.query)((0,d.collection)(e.db,this.collection),(0,d.where)("cookerId","==",a),(0,d.orderBy)("createdAt","desc"));return(0,d.aQ)(c,a=>{b(a.docs.map(a=>({id:a.id,...a.data()})))})}static subscribeToDriverAvailableOrders(a){let b=(0,d.query)((0,d.collection)(e.db,this.collection),(0,d.where)("status","in",["pending","accepted","preparing","ready"]));return(0,d.aQ)(b,b=>{let c=b.docs.map(a=>({id:a.id,...a.data()}));c.sort((a,b)=>(a.createdAt?.toMillis()||0)-(b.createdAt?.toMillis()||0)),a(c)},b=>{console.error("Error in driver available orders subscription:",b),a([])})}static subscribeToCustomerOrders(a,b){let c=(0,d.query)((0,d.collection)(e.db,this.collection),(0,d.where)("customerId","==",a));return(0,d.aQ)(c,a=>{let c=a.docs.map(a=>({id:a.id,...a.data()}));c.sort((a,b)=>{let c=a.createdAt?.toDate()||new Date(0);return(b.createdAt?.toDate()||new Date(0)).getTime()-c.getTime()}),b(c)},a=>{console.error("Error in customer orders subscription:",a),b([])})}static subscribeToOrdersByCook(a,b){let c=(0,d.query)((0,d.collection)(e.db,this.collection),(0,d.where)("cookerId","==",a));return(0,d.aQ)(c,a=>{let c=a.docs.map(a=>({id:a.id,...a.data()}));c.sort((a,b)=>{let c=a.createdAt?.toDate()||new Date(0);return(b.createdAt?.toDate()||new Date(0)).getTime()-c.getTime()}),b(c)},a=>{console.error("Error in cook orders subscription:",a),b([])})}static subscribeToOrder(a,b){return(0,d.aQ)((0,d.doc)(e.db,this.collection,a),a=>{a.exists()?b({id:a.id,...a.data()}):b(null)},a=>{console.error("Error in order subscription:",a),b(null)})}static async addOrderReview(a,b){try{return await (0,d.mZ)((0,d.doc)(e.db,this.collection,a),{review:b,reviewed:!0,updatedAt:d.Dc.now()}),!0}catch(a){return console.error("Error adding order review:",a),!1}}static async deleteOrder(a){try{return await (0,d.kd)((0,d.doc)(e.db,this.collection,a)),!0}catch(a){return console.error("Error deleting order:",a),!1}}static async startDeliveryTracking(a,b){try{let c=d.Dc.now();return await (0,d.mZ)((0,d.doc)(e.db,this.collection,a),{status:"en_viaje",tracking:{driverLocation:{...b,timestamp:c},trackingStarted:c,lastLocationUpdate:c},updatedAt:c}),!0}catch(a){return console.error("Error starting delivery tracking:",a),!1}}static async updateDriverLocation(a,b,c){try{let f=d.Dc.now(),g={"tracking.driverLocation":{...b,timestamp:f},"tracking.lastLocationUpdate":f,updatedAt:f};return c&&(g["tracking.route"]={...c,estimatedArrival:d.Dc.fromDate(c.estimatedArrival)}),await (0,d.mZ)((0,d.doc)(e.db,this.collection,a),g),!0}catch(a){return console.error("Error updating driver location:",a),!1}}static async endDeliveryTracking(a){try{let b=d.Dc.now();return await (0,d.mZ)((0,d.doc)(e.db,this.collection,a),{status:"delivered","tracking.trackingEnded":b,actualDeliveryTime:b,updatedAt:b}),!0}catch(a){return console.error("Error ending delivery tracking:",a),!1}}static async getOrdersWithDetails(){try{let a=await this.getAllOrders(),b=[...new Set(a.map(a=>a.cookerId).filter(Boolean))],c=[...new Set(a.map(a=>a.driverId).filter(Boolean))],[d,e]=await Promise.all([Promise.all(b.map(async a=>{let b=await g.getCookById(a);return{id:a,data:b}})),Promise.all(c.map(async a=>{let b=await j.getDriverById(a);return{id:a,data:b}}))]),f=new Map(d.map(a=>[a.id,a.data])),h=new Map(e.map(a=>[a.id,a.data]));return a.map(a=>({...a,cookInfo:a.cookerId?f.get(a.cookerId):void 0,driverInfo:a.driverId?h.get(a.driverId):void 0}))}catch(a){return console.error("Error getting orders with details:",a),[]}}}class i{static{this.collection="reviews"}static async getReviewsByCook(a){try{return(await (0,d.getDocs)((0,d.query)((0,d.collection)(e.db,this.collection),(0,d.where)("cookerId","==",a),(0,d.orderBy)("createdAt","desc")))).docs.map(a=>({id:a.id,...a.data()}))}catch(b){return console.error("Error fetching reviews with index, trying fallback:",b),this.getReviewsByCookFallback(a)}}static async getReviewsByCookFallback(a){try{return(await (0,d.getDocs)((0,d.collection)(e.db,this.collection))).docs.map(a=>({id:a.id,...a.data()})).filter(b=>b.cookerId===a).sort((a,b)=>{let c=a.createdAt?.toMillis()||0;return(b.createdAt?.toMillis()||0)-c})}catch(a){return console.error("Error fetching reviews (fallback):",a),[]}}static async getReviewsByDish(a){try{return(await (0,d.getDocs)((0,d.query)((0,d.collection)(e.db,this.collection),(0,d.where)("dishId","==",a),(0,d.orderBy)("createdAt","desc")))).docs.map(a=>({id:a.id,...a.data()}))}catch(b){console.error("Error fetching reviews by dish:",b);try{return(await (0,d.getDocs)((0,d.collection)(e.db,this.collection))).docs.map(a=>({id:a.id,...a.data()})).filter(b=>b.dishId===a).sort((a,b)=>{let c=a.createdAt?.toMillis()||0;return(b.createdAt?.toMillis()||0)-c})}catch(a){return console.error("Error in fallback review fetch:",a),[]}}}static async getReviewsByOrder(a){try{return(await (0,d.getDocs)((0,d.query)((0,d.collection)(e.db,this.collection),(0,d.where)("orderId","==",a)))).docs.map(a=>({id:a.id,...a.data()}))}catch(a){return console.error("Error fetching reviews by order:",a),[]}}static async createReview(a){try{let b=await (0,d.gS)((0,d.collection)(e.db,this.collection),{...a,createdAt:d.Dc.now()});if(a.cookerId){let b=await this.getReviewsByCook(a.cookerId),c=b.length>0?b.reduce((a,b)=>a+b.rating,0)/b.length:a.rating;await g.updateCookProfile(a.cookerId,{rating:Number(c.toFixed(1)),reviewCount:b.length})}if(a.dishId){let b=await this.getReviewsByDish(a.dishId),c=b.length>0?b.reduce((a,b)=>a+b.rating,0)/b.length:a.rating;await f.updateDish(a.dishId,{rating:Number(c.toFixed(1)),reviewCount:b.length})}return b.id}catch(a){return console.error("Error creating review:",a),null}}}class j{static{this.collection="drivers"}static async getAllDrivers(){try{return(await (0,d.getDocs)((0,d.query)((0,d.collection)(e.db,this.collection),(0,d.orderBy)("rating","desc")))).docs.map(a=>({id:a.id,...a.data()}))}catch(a){return console.error("Error fetching drivers:",a),[]}}static async getDriverById(a){try{let b=(0,d.doc)(e.db,this.collection,a),c=await (0,d.getDoc)(b);if(c.exists())return{id:c.id,...c.data()};return null}catch(a){return console.error("Error fetching driver:",a),null}}static async updateDriverProfile(a,b){try{console.log("Attempting to update driver profile:",a,b);let c=(0,d.doc)(e.db,this.collection,a);if(!(await (0,d.getDoc)(c)).exists())return console.error("Driver document does not exist:",a),!1;return await (0,d.mZ)(c,{...b,updatedAt:d.Dc.now()}),console.log("Driver profile updated successfully"),!0}catch(c){return console.error("Error updating driver profile:",c),console.error("Error details:",{code:c.code,message:c.message,driverId:a,updates:b}),!1}}static async createDriverProfile(a,b){try{console.log("Creating driver profile:",b,a);let c=d.Dc.now();if(b){let f=(0,d.doc)(e.db,this.collection,b);return await (0,d.BN)(f,{...a,createdAt:c,updatedAt:c}),console.log("Driver profile created successfully with ID:",b),b}{let b=await (0,d.gS)((0,d.collection)(e.db,this.collection),{...a,createdAt:c,updatedAt:c});return console.log("Driver profile created successfully with ID:",b.id),b.id}}catch(c){return console.error("Error creating driver profile:",c),console.error("Error details:",{code:c.code,message:c.message,driverId:b,dataKeys:Object.keys(a)}),null}}static async deleteDriver(a){try{return await (0,d.kd)((0,d.doc)(e.db,this.collection,a)),!0}catch(a){return console.error("Error deleting driver:",a),!1}}static async getOrdersByDriver(a){try{return(await (0,d.getDocs)((0,d.query)((0,d.collection)(e.db,this.collection),(0,d.where)("driverId","==",a),(0,d.orderBy)("createdAt","desc")))).docs.map(a=>({id:a.id,...a.data()}))}catch(a){return console.error("Error fetching driver orders:",a),[]}}static async getActiveOrdersByDriver(a){try{return(await (0,d.getDocs)((0,d.query)((0,d.collection)(e.db,this.collection),(0,d.where)("driverId","==",a),(0,d.where)("status","in",["delivering","picked_up"]),(0,d.orderBy)("createdAt","desc")))).docs.map(a=>({id:a.id,...a.data()}))}catch(a){return console.error("Error fetching active driver orders:",a),[]}}static async getDriverStats(a){try{let b=await this.getOrdersByDriver(a),c=new Date;c.setHours(0,0,0,0),d.Dc.fromDate(c);let e=b.filter(a=>(a.createdAt?.toDate()||new Date(0))>=c).filter(a=>"delivered"===a.status),f=e.reduce((a,b)=>a+(b.deliveryFee||0),0),g=b.filter(a=>"delivered"===a.status),h=b.length,i=h>0?g.length/h*100:0;return{todayEarnings:f,todayDeliveries:e.length,totalDeliveries:g.length,completionRate:i}}catch(a){return console.error("Error calculating driver stats:",a),{todayEarnings:0,todayDeliveries:0,totalDeliveries:0,completionRate:0}}}static subscribeToDriverOrders(a,b){let c=(0,d.query)((0,d.collection)(e.db,this.collection),(0,d.where)("driverId","==",a));return(0,d.aQ)(c,a=>{let c=a.docs.map(a=>({id:a.id,...a.data()}));c.sort((a,b)=>{let c=a.createdAt?.toMillis()||0;return(b.createdAt?.toMillis()||0)-c}),b(c)},a=>{console.error("Error in driver orders subscription:",a),b([])})}}class k{static async deleteCook(a,b){try{let c=await f.getDishesByCook(a),g=c.map(a=>f.deleteDish(a.id));return await Promise.all(g),await (0,d.kd)((0,d.doc)(e.db,"cooks",a)),console.log(`Admin ${b} deleted cook ${a} and ${c.length} associated dishes`),!0}catch(a){return console.error("Error deleting cook (admin):",a),!1}}static async deleteDish(a,b){try{return await f.deleteDish(a),console.log(`Admin ${b} deleted dish ${a}`),!0}catch(a){return console.error("Error deleting dish (admin):",a),!1}}static async deleteDriver(a,b){try{return await j.deleteDriver(a),console.log(`Admin ${b} deleted driver ${a}`),!0}catch(a){return console.error("Error deleting driver (admin):",a),!1}}static async getAllUsers(){try{let[a,b,c]=await Promise.all([g.getAllCooks(),j.getAllDrivers(),f.getAllDishes()]);return{cooks:a,drivers:b,dishes:c}}catch(a){return console.error("Error fetching all users:",a),{cooks:[],drivers:[],dishes:[]}}}static async getUsersStatistics(){try{let[a,b]=await Promise.all([g.getAllCooks(),j.getAllDrivers()]),c=Math.max(50,(a.length+b.length)*3),d=Math.floor(.7*c);return{totalClients:c,totalCooks:a.length,totalDrivers:b.length,activeUsers:d}}catch(a){return console.error("Error getting user statistics:",a),{totalClients:0,totalCooks:0,totalDrivers:0,activeUsers:0}}}static async getOrdersStatistics(){try{let a=await h.getAllOrders(),b=new Date;b.setHours(0,0,0,0);let c=a.filter(a=>a.createdAt.toDate()>=b),d=a.filter(a=>["pending","accepted","preparing","ready","delivering"].includes(a.status)).length,e=c.filter(a=>"delivered"===a.status),f=e.reduce((a,b)=>a+b.total,0);return{totalOrders:a.length,activeOrders:d,todayRevenue:f,completedToday:e.length}}catch(a){return console.error("Error getting order statistics:",a),{totalOrders:0,activeOrders:0,todayRevenue:0,completedToday:0}}}static async isAdmin(a){try{let b=await (0,d.getDoc)((0,d.doc)(e.db,"users",a));if(b.exists()){let a=b.data();return"admin"===a.role||"Admin"===a.role}return!1}catch(a){return console.error("Error checking admin status:",a),!1}}}class l{static{this.collection="appSettings"}static{this.settingsDocId="main"}static async getSettings(){try{let a=(0,d.doc)(e.db,this.collection,this.settingsDocId),b=await (0,d.getDoc)(a);if(b.exists())return{id:b.id,...b.data()};let c={deliveryFee:{baseRate:0,freeDeliveryThreshold:25e3,isEnabled:!1},serviceFee:{percentage:.12,isEnabled:!0},updatedAt:d.Dc.now(),updatedBy:"system"};try{await (0,d.BN)(a,c),console.log("Created default app settings")}catch(a){console.warn("Could not create default settings, using fallback:",a)}return{id:this.settingsDocId,...c}}catch(a){return console.error("Error fetching app settings:",a),{id:this.settingsDocId,deliveryFee:{baseRate:0,freeDeliveryThreshold:25e3,isEnabled:!1},serviceFee:{percentage:.12,isEnabled:!0},updatedAt:d.Dc.now(),updatedBy:"system"}}}static async updateSettings(a,b){try{let c=(0,d.doc)(e.db,this.collection,this.settingsDocId);return await (0,d.BN)(c,{...a,updatedAt:d.Dc.now(),updatedBy:b},{merge:!0}),!0}catch(a){return console.error("Error updating app settings:",a),!1}}}class m{static async getCookStats(a){try{let b=await h.getOrdersByCook(a),c=b.filter(a=>"delivered"===a.status).reduce((a,b)=>a+b.total,0),d=(await f.getDishesByCook(a)).filter(a=>a.isAvailable).length,e=b.filter(a=>["pending","accepted","preparing","ready","delivering"].includes(a.status)).length,g=await i.getReviewsByCook(a),j=g.length>0?g.reduce((a,b)=>a+b.rating,0)/g.length:0;return{totalEarnings:c,activeDishes:d,pendingOrders:e,averageRating:Number(j.toFixed(1)),totalOrders:b.length,reviewCount:g.length}}catch(a){return console.error("Error calculating cook stats:",a),{totalEarnings:0,activeDishes:0,pendingOrders:0,averageRating:0,totalOrders:0,reviewCount:0}}}}},92241:(a,b,c)=>{"use strict";c.d(b,{CG:()=>k,Fm:()=>p,Qs:()=>r,cj:()=>j,h:()=>o,qp:()=>q});var d=c(60687),e=c(43210),f=c(26134),g=c(24224),h=c(11860),i=c(96241);let j=f.bL,k=f.l9;f.bm;let l=f.ZL,m=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)(f.hJ,{className:(0,i.cn)("fixed inset-0 z-50 bg-background/80 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...b,ref:c}));m.displayName=f.hJ.displayName;let n=(0,g.F)("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),o=e.forwardRef(({side:a="right",className:b,children:c,...e},g)=>(0,d.jsxs)(l,{children:[(0,d.jsx)(m,{}),(0,d.jsxs)(f.UC,{ref:g,className:(0,i.cn)(n({side:a}),b),...e,children:[c,(0,d.jsxs)(f.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[(0,d.jsx)(h.A,{className:"h-4 w-4"}),(0,d.jsx)("span",{className:"sr-only",children:"Close"})]})]})]}));o.displayName=f.UC.displayName;let p=({className:a,...b})=>(0,d.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-2 text-center sm:text-left",a),...b});p.displayName="SheetHeader";let q=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)(f.hE,{ref:c,className:(0,i.cn)("text-lg font-semibold text-foreground",a),...b}));q.displayName=f.hE.displayName;let r=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)(f.VY,{ref:c,className:(0,i.cn)("text-sm text-muted-foreground",a),...b}));r.displayName=f.VY.displayName},92415:(a,b,c)=>{Promise.resolve().then(c.bind(c,19550))},93331:(a,b,c)=>{"use strict";c.d(b,{ErrorBoundary:()=>l});var d=c(60687),e=c(43210),f=c(24934),g=c(55192),h=c(43649),i=c(78122),j=c(32192),k=c(40332);class l extends e.Component{constructor(a){super(a),this.handleRetry=()=>{k.z.trackUserAction("error_retry","error_boundary"),this.setState({hasError:!1,error:void 0,errorInfo:void 0})},this.handleGoHome=()=>{k.z.trackUserAction("error_go_home","error_boundary"),window.location.href="/"},this.state={hasError:!1}}static getDerivedStateFromError(a){return{hasError:!0,error:a}}componentDidCatch(a,b){k.z.trackError(a,{component:"ErrorBoundary",errorBoundary:!0,errorInfo:{componentStack:b.componentStack},timestamp:new Date().toISOString()}),this.props.onError&&this.props.onError(a,b),this.setState({error:a,errorInfo:b})}render(){return this.state.hasError?this.props.fallback?this.props.fallback:(0,d.jsx)("div",{className:"min-h-screen flex items-center justify-center p-4 bg-background",children:(0,d.jsxs)(g.Zp,{className:"w-full max-w-md",children:[(0,d.jsxs)(g.aR,{className:"text-center",children:[(0,d.jsx)("div",{className:"mx-auto mb-4 flex h-12 w-12 items-center justify-center rounded-full bg-red-100",children:(0,d.jsx)(h.A,{className:"h-6 w-6 text-red-600"})}),(0,d.jsx)(g.ZB,{className:"text-xl",children:"\xa1Ups! Algo sali\xf3 mal"})]}),(0,d.jsxs)(g.Wu,{className:"space-y-4",children:[(0,d.jsx)("p",{className:"text-center text-muted-foreground",children:"Ha ocurrido un error inesperado. Nuestro equipo ha sido notificado y estamos trabajando para solucionarlo."}),!1,(0,d.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,d.jsxs)(f.$,{onClick:this.handleRetry,className:"w-full",children:[(0,d.jsx)(i.A,{className:"h-4 w-4 mr-2"}),"Intentar de nuevo"]}),(0,d.jsxs)(f.$,{variant:"outline",onClick:this.handleGoHome,className:"w-full",children:[(0,d.jsx)(j.A,{className:"h-4 w-4 mr-2"}),"Ir al inicio"]})]}),(0,d.jsx)("p",{className:"text-xs text-center text-muted-foreground",children:"Si el problema persiste, por favor contacta a nuestro soporte."})]})]})}):this.props.children}}},94593:(a,b,c)=>{"use strict";c.d(b,{Toaster:()=>g});var d=c(60687),e=c(10218),f=c(52581);let g=({...a})=>{let{theme:b="system"}=(0,e.D)();return(0,d.jsx)(f.l$,{theme:b,className:"toaster group",style:{"--normal-bg":"var(--popover)","--normal-text":"var(--popover-foreground)","--normal-border":"var(--border)"},...a})}},96241:(a,b,c)=>{"use strict";c.d(b,{$B:()=>m,$g:()=>g,Dm:()=>j,HM:()=>i,bC:()=>l,cn:()=>f,generateDeliveryCode:()=>h,uA:()=>k});var d=c(49384),e=c(82348);function f(...a){return(0,e.QP)((0,d.$)(a))}function g(a){return`$${Math.round(a).toLocaleString("es-CL")}`}function h(){return Math.floor(1e3+9e3*Math.random()).toString()}function i(a){return a.replace(/(\d{2})(\d{2})/,"$1-$2")}function j(a){let b=0;return a.forEach(a=>{let c=function(a){let b=a.toLowerCase();return b.includes("hour")?60*parseFloat(b.match(/(\d+(?:\.\d+)?)/)?.[1]||"1"):b.includes("min")?parseInt(b.match(/(\d+)/)?.[1]||"30"):30}(a.prepTime);c>b&&(b=c)}),b}function k(a,b){return Math.min(Math.max((new Date().getTime()-a.getTime())/6e4/b*100,0),100)}function l(a,b){let c=new Date(a);return c.setMinutes(c.getMinutes()+b),c}function m(a,b){let c=new Date,d=l(a,b).getTime()-c.getTime();if(d<=0)return"Listo";let e=Math.ceil(d/6e4);if(e<60)return`${e} min`;{let a=Math.floor(e/60);return`${a}h ${e%60}m`}}},96896:(a,b,c)=>{Promise.resolve().then(c.bind(c,53960)),Promise.resolve().then(c.bind(c,50472)),Promise.resolve().then(c.bind(c,44493)),Promise.resolve().then(c.bind(c,81834)),Promise.resolve().then(c.bind(c,70465)),Promise.resolve().then(c.bind(c,23856)),Promise.resolve().then(c.bind(c,80363)),Promise.resolve().then(c.bind(c,73549)),Promise.resolve().then(c.bind(c,47136)),Promise.resolve().then(c.bind(c,74237)),Promise.resolve().then(c.bind(c,20253)),Promise.resolve().then(c.bind(c,3465))}};