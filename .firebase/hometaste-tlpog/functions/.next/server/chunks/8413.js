"use strict";exports.id=8413,exports.ids=[8413],exports.modules={18413:(a,b,c)=>{c.r(b),c.d(b,{DeliveryTrackingService:()=>f});var d=c(56525),e=c(75535);class f{static{this.collection="deliveryTracking"}static async updateDeliveryTracking(a){try{let b=(0,e.doc)(d.db,this.collection,a.orderId);return await (0,e.BN)(b,{...a,lastUpdated:e.Dc.now()},{merge:!0}),!0}catch(a){return console.error("Error updating delivery tracking:",a),!1}}static subscribeToDeliveryTracking(a,b){let c=(0,e.doc)(d.db,this.collection,a);return(0,e.aQ)(c,a=>{a.exists()?b({orderId:a.id,...a.data()}):b(null)},a=>{console.error("Error subscribing to delivery tracking:",a),b(null)})}static async updateDriverLocation(a,b){try{let c=(0,e.doc)(d.db,this.collection,a);return await (0,e.mZ)(c,{currentLocation:{...b,timestamp:e.Dc.now()},lastUpdated:e.Dc.now()}),!0}catch(a){return console.error("Error updating driver location:",a),!1}}static async updateETA(a,b){try{let c=(0,e.doc)(d.db,this.collection,a),f={lastUpdated:e.Dc.now()};return b.pickup&&(f.estimatedPickupTime=b.pickup),b.delivery&&(f.estimatedDeliveryTime=b.delivery),b.total&&(f.totalEstimatedTime=b.total),await (0,e.mZ)(c,f),!0}catch(a){return console.error("Error updating ETA:",a),!1}}static async updateDeliveryStep(a,b){try{let c=(0,e.doc)(d.db,this.collection,a);return await (0,e.mZ)(c,{currentStep:b,lastUpdated:e.Dc.now()}),!0}catch(a){return console.error("Error updating delivery step:",a),!1}}static async completeDelivery(a){try{let b=(0,e.doc)(d.db,this.collection,a);return await (0,e.mZ)(b,{currentStep:"delivered",lastUpdated:e.Dc.now()}),!0}catch(a){return console.error("Error completing delivery:",a),!1}}static getCurrentLocation(){return new Promise((a,b)=>{if(!navigator.geolocation)return void b(Error("Geolocation not supported"));navigator.geolocation.getCurrentPosition(b=>{a({lat:b.coords.latitude,lng:b.coords.longitude})},a=>b(a),{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e4})})}static calculateDistance(a,b,c,d){let e=(c-a)*Math.PI/180,f=(d-b)*Math.PI/180,g=Math.sin(e/2)*Math.sin(e/2)+Math.cos(a*Math.PI/180)*Math.cos(c*Math.PI/180)*Math.sin(f/2)*Math.sin(f/2);return 2*Math.atan2(Math.sqrt(g),Math.sqrt(1-g))*6371}static startLocationTracking(a,b,c,d){let e=null,f=0,g=async()=>{try{let b=await this.getCurrentLocation(),c=Date.now();c-f>1e4&&(await this.updateDriverLocation(a,b),f=c),d?.(b)}catch(a){console.error("Error updating location:",a)}};return navigator.geolocation&&(e=navigator.geolocation.watchPosition(()=>g(),a=>console.error("Geolocation error:",a),{enableHighAccuracy:!0,timeout:1e4,maximumAge:5e3})),g(),{stop:()=>{null!==e&&navigator.geolocation.clearWatch(e)}}}}}};