(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5957],{34964:(e,s,r)=>{"use strict";r.d(s,{Xi:()=>c,av:()=>o,j7:()=>d,tU:()=>n});var a=r(95155),t=r(12115),i=r(60704),l=r(53999);let n=i.bL,d=t.forwardRef((e,s)=>{let{className:r,...t}=e;return(0,a.jsx)(i.B8,{ref:s,className:(0,l.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",r),...t})});d.displayName=i.B8.displayName;let c=t.forwardRef((e,s)=>{let{className:r,...t}=e;return(0,a.jsx)(i.l9,{ref:s,className:(0,l.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",r),...t})});c.displayName=i.l9.displayName;let o=t.forwardRef((e,s)=>{let{className:r,...t}=e;return(0,a.jsx)(i.UC,{ref:s,className:(0,l.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",r),...t})});o.displayName=i.UC.displayName},51502:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>B});var a=r(95155),t=r(12115),i=r(25731),l=r(35695),n=r(46751),d=r(35317),c=r(66579),o=r(53999),m=r(14186),x=r(46561),u=r(40646),h=r(79397),j=r(37108),p=r(29799),g=r(1243),v=r(17951),f=r(53904),N=r(34835),b=r(55868),y=r(23861),w=r(50744),A=r(92657),k=r(62525),E=r(71007),C=r(17580),S=r(97168),R=r(88482),I=r(88145),_=r(34964),O=r(56671),Z=r(99840);let D=(0,r(55028).default)(()=>Promise.all([r.e(9484),r.e(1761),r.e(7546),r.e(1325)]).then(r.bind(r,57546)),{loadableGenerated:{webpack:()=>[57546]},ssr:!1,loading:()=>(0,a.jsx)("div",{className:"h-64 bg-muted rounded-lg flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Cargando mapa..."})]})})}),B=()=>{let{user:e,logout:s}=(0,i.A)(),r=(0,l.useRouter)(),[B,P]=(0,t.useState)([]),[W,$]=(0,t.useState)({totalOrders:0,activeOrders:0,pendingApproval:0,totalRevenue:0,activeDrivers:0,activeCooks:0}),[T,z]=(0,t.useState)(!0),[L,F]=(0,t.useState)(!1),[U,G]=(0,t.useState)(!0),[V,X]=(0,t.useState)(!1),[H,q]=(0,t.useState)(null);(0,t.useEffect)(()=>{(async()=>{if(!e)return r.push("/login");try{let s=await n.AdminService.isAdmin(e.uid);if(F(s),!s)return void r.push("/")}catch(e){console.error("Error checking admin status:",e),r.push("/")}finally{G(!1)}})()},[e,r]),(0,t.useEffect)(()=>{if(!L)return;let e=async()=>{try{z(!0);let e=await n.OrdersService.getOrdersWithDetails();P(e),M(e)}catch(r){console.error("Error fetching detailed orders:",r);let e=(0,d.query)((0,d.collection)(c.db,"orders"),(0,d.orderBy)("createdAt","desc")),s=(await (0,d.getDocs)(e)).docs.map(e=>({id:e.id,...e.data()}));P(s),M(s)}finally{z(!1)}};e();let s=(0,d.query)((0,d.collection)(c.db,"orders"),(0,d.orderBy)("createdAt","desc")),r=(0,d.aQ)(s,()=>{e()});return()=>r()},[L]);let M=e=>{let s=new Date;s.setHours(0,0,0,0);let r=e.filter(e=>{var r;let a=null==(r=e.createdAt)?void 0:r.toDate();return a&&a>=s}),a=e.filter(e=>["pending_approval","pending","accepted","preparing","ready","delivering"].includes(e.status)),t=e.filter(e=>"pending_approval"===e.status),i=r.filter(e=>"delivered"===e.status).reduce((e,s)=>e+(s.total||0),0);$({totalOrders:r.length,activeOrders:a.length,pendingApproval:t.length,totalRevenue:i,activeDrivers:0,activeCooks:0})},Q=async()=>{if(H)try{await n.OrdersService.deleteOrder(H)?O.oR.success("Pedido eliminado correctamente"):O.oR.error("Error al eliminar el pedido")}catch(e){console.error("Error deleting order:",e),O.oR.error("Error al eliminar el pedido")}finally{X(!1),q(null)}};return U?(0,a.jsx)("div",{className:"min-h-screen bg-background flex items-center justify-center",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):L?(0,a.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,a.jsx)("div",{className:"border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60",children:(0,a.jsx)("div",{className:"container mx-auto px-4 py-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(v.A,{className:"h-8 w-8 text-primary"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"Admin Dashboard"}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Monitor en tiempo real \xb7 ",null==e?void 0:e.email]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)(S.$,{variant:"outline",size:"sm",onClick:()=>window.location.reload(),children:[(0,a.jsx)(f.A,{className:"h-4 w-4 mr-2"}),"Actualizar"]}),(0,a.jsxs)(S.$,{variant:"outline",size:"sm",onClick:s,children:[(0,a.jsx)(N.A,{className:"h-4 w-4 mr-2"}),"Salir"]})]})]})})}),(0,a.jsxs)("div",{className:"container mx-auto px-4 py-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[(0,a.jsx)(R.Zp,{children:(0,a.jsx)(R.Wu,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"\xd3rdenes Hoy"}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:W.totalOrders})]}),(0,a.jsx)(j.A,{className:"h-8 w-8 text-blue-600"})]})})}),(0,a.jsx)(R.Zp,{children:(0,a.jsx)(R.Wu,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"\xd3rdenes Activas"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-green-600",children:W.activeOrders})]}),(0,a.jsx)(h.A,{className:"h-8 w-8 text-green-600"})]})})}),(0,a.jsx)(R.Zp,{children:(0,a.jsx)(R.Wu,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Esperando Aprobaci\xf3n"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-yellow-600",children:W.pendingApproval})]}),(0,a.jsx)(m.A,{className:"h-8 w-8 text-yellow-600"})]})})}),(0,a.jsx)(R.Zp,{children:(0,a.jsx)(R.Wu,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Ingresos Hoy"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-emerald-600",children:(0,o.$g)(W.totalRevenue)})]}),(0,a.jsx)(b.A,{className:"h-8 w-8 text-emerald-600"})]})})})]}),(0,a.jsxs)(_.tU,{defaultValue:"orders",className:"space-y-6",children:[(0,a.jsxs)(_.j7,{className:"grid w-full grid-cols-3",children:[(0,a.jsx)(_.Xi,{value:"orders",children:"\xd3rdenes en Tiempo Real"}),(0,a.jsx)(_.Xi,{value:"tracking",children:"Seguimiento GPS"}),(0,a.jsx)(_.Xi,{value:"system",children:"Estado del Sistema"})]}),(0,a.jsx)(_.av,{value:"orders",className:"space-y-6",children:(0,a.jsxs)(R.Zp,{children:[(0,a.jsx)(R.aR,{children:(0,a.jsxs)(R.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(y.A,{className:"h-5 w-5"}),"\xd3rdenes en Tiempo Real",(0,a.jsxs)(I.E,{variant:"outline",className:"ml-auto",children:[B.length," total"]})]})}),(0,a.jsx)(R.Wu,{children:T?(0,a.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):0===B.length?(0,a.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No hay \xf3rdenes todav\xeda"}):(0,a.jsx)("div",{className:"space-y-4",children:B.slice(0,20).map(e=>{var s,t,i,l;return(0,a.jsxs)("div",{className:"p-4 border rounded-lg hover:bg-muted/50 transition-colors",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(e=>{switch(e){case"pending_approval":return(0,a.jsx)(m.A,{className:"h-4 w-4"});case"pending":return(0,a.jsx)(x.A,{className:"h-4 w-4"});case"accepted":case"delivered":return(0,a.jsx)(u.A,{className:"h-4 w-4"});case"preparing":default:return(0,a.jsx)(h.A,{className:"h-4 w-4"});case"ready":return(0,a.jsx)(j.A,{className:"h-4 w-4"});case"delivering":return(0,a.jsx)(p.A,{className:"h-4 w-4"});case"cancelled":case"rejected":return(0,a.jsx)(g.A,{className:"h-4 w-4"})}})(e.status),(0,a.jsx)(I.E,{className:(e=>{switch(e){case"pending_approval":return"bg-yellow-100 text-yellow-800";case"pending":return"bg-blue-100 text-blue-800";case"accepted":return"bg-green-100 text-green-800";case"preparing":return"bg-orange-100 text-orange-800";case"ready":return"bg-purple-100 text-purple-800";case"delivering":return"bg-indigo-100 text-indigo-800";case"delivered":return"bg-emerald-100 text-emerald-800";case"cancelled":case"rejected":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}})(e.status),children:(e=>({pending_approval:"Esperando Aprobaci\xf3n",pending:"Pendiente",accepted:"Aceptada",preparing:"Preparando",ready:"Lista",delivering:"En Camino",delivered:"Entregada",cancelled:"Cancelada",rejected:"Rechazada"})[e]||e)(e.status)})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"font-medium",children:["#",e.id.slice(-8)]}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:[e.customerName," • ",(null==(s=e.dishes)?void 0:s.length)||0," items"]}),e.dishes&&e.dishes.length>0&&(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:[e.dishes.slice(0,2).map(e=>e.dishName).join(", "),e.dishes.length>2?"...":""]})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"font-semibold",children:(0,o.$g)(e.total||0)}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:null==(t=e.createdAt)?void 0:t.toDate().toLocaleTimeString("es-CL",{hour:"2-digit",minute:"2-digit"})})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-3 text-sm",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 p-2 bg-orange-50 rounded-lg",children:[(0,a.jsx)(w.A,{className:"h-4 w-4 text-orange-600"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("span",{className:"text-muted-foreground text-xs",children:"Cocinero:"}),(0,a.jsx)("div",{className:"font-medium",children:e.cookInfo?(0,a.jsxs)(a.Fragment,{children:[e.cookInfo.name||e.cookInfo.displayName||"Sin nombre",(0,a.jsxs)("span",{className:"text-xs text-muted-foreground ml-2",children:["⭐ ",(null==(i=e.cookInfo.rating)?void 0:i.toFixed(1))||"N/A"]})]}):(0,a.jsx)("span",{className:"text-muted-foreground",children:"Cargando..."})})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 p-2 bg-blue-50 rounded-lg",children:[(0,a.jsx)(p.A,{className:"h-4 w-4 text-blue-600"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("span",{className:"text-muted-foreground text-xs",children:"Conductor:"}),(0,a.jsx)("div",{className:"font-medium",children:e.driverInfo?(0,a.jsxs)(a.Fragment,{children:[e.driverInfo.name||e.driverInfo.displayName||"Sin nombre",(0,a.jsxs)("span",{className:"text-xs text-muted-foreground ml-2",children:["⭐ ",(null==(l=e.driverInfo.rating)?void 0:l.toFixed(1))||"N/A"]})]}):"ready"===e.status||"delivering"===e.status||"en_viaje"===e.status?(0,a.jsx)("span",{className:"text-yellow-600",children:"Buscando conductor..."}):(0,a.jsx)("span",{className:"text-muted-foreground",children:"No asignado"})})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 justify-end",children:[(0,a.jsxs)(S.$,{variant:"outline",size:"sm",onClick:()=>r.push("/orders/".concat(e.id)),children:[(0,a.jsx)(A.A,{className:"h-4 w-4 mr-2"}),"Ver"]}),(0,a.jsxs)(S.$,{variant:"outline",size:"sm",className:"text-red-600 hover:text-red-700 hover:bg-red-50",onClick:()=>{q(e.id),X(!0)},children:[(0,a.jsx)(k.A,{className:"h-4 w-4 mr-2"}),"Eliminar"]})]})]},e.id)})})})]})}),(0,a.jsx)(_.av,{value:"tracking",className:"space-y-6",children:(0,a.jsxs)(R.Zp,{children:[(0,a.jsx)(R.aR,{children:(0,a.jsxs)(R.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(p.A,{className:"h-5 w-5"}),"Seguimiento GPS en Tiempo Real",(0,a.jsxs)(I.E,{variant:"outline",className:"ml-auto",children:[B.filter(e=>"en_viaje"===e.status).length," en viaje"]})]})}),(0,a.jsx)(R.Wu,{children:T?(0,a.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):0===B.filter(e=>"en_viaje"===e.status).length?(0,a.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No hay entregas en viaje en este momento"}):(0,a.jsx)("div",{className:"space-y-6",children:B.filter(e=>"en_viaje"===e.status).map(e=>{var s,r,t;return(0,a.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"font-semibold",children:["Pedido #",e.id.slice(-8)]}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:[e.customerName," • ",(null==(s=e.dishes)?void 0:s.length)||0," items"]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"font-semibold",children:(0,o.$g)(e.total||0)}),(0,a.jsx)(I.E,{className:"bg-blue-100 text-blue-800",children:"En Viaje"})]})]}),e.driverInfo&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-muted rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(E.A,{className:"h-5 w-5 text-blue-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:e.driverInfo.name}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:["⭐ ",(null==(r=e.driverInfo.rating)?void 0:r.toFixed(1))||"N/A"," • ",e.driverInfo.vehicleType||"Veh\xedculo"]})]})]})}),(0,a.jsx)(D,{orderId:e.id,customerLocation:{lat:-33.4489,lng:-70.6693,address:(null==(t=e.deliveryInfo)?void 0:t.address)||"Direcci\xf3n no disponible"},estimatedTime:30,isAdmin:!0})]},e.id)})})})]})}),(0,a.jsx)(_.av,{value:"system",className:"space-y-6",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,a.jsxs)(R.Zp,{children:[(0,a.jsx)(R.aR,{children:(0,a.jsxs)(R.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(C.A,{className:"h-5 w-5"}),"Usuarios Activos"]})}),(0,a.jsx)(R.Wu,{children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{children:"Cocineros Activos"}),(0,a.jsx)(I.E,{variant:"outline",children:W.activeCooks})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{children:"Conductores Activos"}),(0,a.jsx)(I.E,{variant:"outline",children:W.activeDrivers})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{children:"\xd3rdenes en Proceso"}),(0,a.jsx)(I.E,{variant:"outline",children:W.activeOrders})]})]})})]}),(0,a.jsxs)(R.Zp,{children:[(0,a.jsx)(R.aR,{children:(0,a.jsxs)(R.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(g.A,{className:"h-5 w-5"}),"Alertas del Sistema"]})}),(0,a.jsx)(R.Wu,{children:(0,a.jsxs)("div",{className:"space-y-3",children:[W.pendingApproval>0&&(0,a.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[(0,a.jsx)(m.A,{className:"h-4 w-4 text-yellow-600"}),(0,a.jsxs)("span",{className:"text-sm",children:[W.pendingApproval," \xf3rdenes esperando aprobaci\xf3n"]})]}),0===W.pendingApproval&&(0,a.jsx)("div",{className:"text-center py-4 text-muted-foreground text-sm",children:"✅ Todo funcionando correctamente"})]})})]})]})})]})]}),(0,a.jsx)(Z.lG,{open:V,onOpenChange:X,children:(0,a.jsxs)(Z.Cf,{children:[(0,a.jsxs)(Z.c7,{children:[(0,a.jsx)(Z.L3,{children:"\xbfEliminar pedido?"}),(0,a.jsxs)(Z.rr,{children:["Esta acci\xf3n no se puede deshacer. El pedido #",null==H?void 0:H.slice(-8)," ser\xe1 eliminado permanentemente."]})]}),(0,a.jsxs)(Z.Es,{children:[(0,a.jsx)(S.$,{variant:"outline",onClick:()=>X(!1),children:"Cancelar"}),(0,a.jsx)(S.$,{variant:"destructive",onClick:Q,children:"Eliminar"})]})]})})]}):null}},67427:(e,s,r)=>{Promise.resolve().then(r.bind(r,51502))}},e=>{e.O(0,[9135,3965,6331,2670,6671,1492,8250,8034,3324,6751,910,8441,5964,7358],()=>e(e.s=67427)),_N_E=e.O()}]);