(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[25],{22684:(e,t,r)=>{"use strict";r.d(t,{z:()=>u});var a=r(84857),s=r(7524),n=r(24013),o=r(96314),i=r(45404),l=r(35317),c=r(66579);class d{static getInstance(){return d.instance||(d.instance=new d),d.instance}async initializeUserContext(){try{let e=(0,i.xI)().currentUser;if(e){this.userId=e.uid;let t=await (0,l.getDoc)((0,l.doc)(c.db,"users",e.uid));t.exists()&&(this.userRole=t.data().role||"client"),a.gV({id:e.uid,email:e.email||void 0,role:this.userRole}),a.Wt({user_role:this.userRole,user_id:e.uid})}}catch(e){console.error("Error initializing user context:",e)}}trackEvent(e){try{s.Z({category:e.category,message:"".concat(e.action).concat(e.label?" - ".concat(e.label):""),level:"info",data:{value:e.value,metadata:e.metadata,userId:e.userId||this.userId}}),window.gtag&&window.gtag("event",e.action,{event_category:e.category,event_label:e.label,value:e.value,custom_user_id:e.userId||this.userId})}catch(e){console.error("Error tracking event:",e)}}trackPerformance(e){try{s.Z({category:"performance",message:"Performance: ".concat(e.name," = ").concat(e.value).concat(e.unit),level:"info",data:{...e,user_role:this.userRole}})}catch(e){console.error("Error tracking performance:",e)}}trackApiCall(e,t,r,a){this.trackEvent({category:"api_call",action:"".concat(t," ").concat(e),value:r,metadata:{success:a,endpoint:e,method:t,duration:r}}),this.trackPerformance({name:"api_response_time",value:r,unit:"ms",tags:{endpoint:e,method:t,success:a.toString()}})}trackPayment(e,t,r,a){this.trackEvent({category:"payment",action:a?"payment_success":"payment_failed",value:e,label:"".concat(r," - ").concat(t),metadata:{amount:e,currency:t,method:r,success:a}})}trackOrder(e,t,r){this.trackEvent({category:"order",action:"order_".concat(t),label:e,value:r,metadata:{orderId:e,status:t,value:r}})}trackUserAction(e,t,r){this.trackEvent({category:"user_action",action:e,label:t,metadata:r})}trackError(e,t){a.Cp(e,{tags:{error_type:"application_error",user_role:this.userRole||"unknown"},extra:{...t,userId:this.userId,timestamp:new Date().toISOString()}})}trackFirebaseOperation(e,t,r,a){this.trackPerformance({name:"firebase_operation",value:r,unit:"ms",tags:{operation:e,collection:t,success:a.toString()}})}trackMercadoPagoOperation(e,t,r){this.trackPerformance({name:"mercadopago_operation",value:t,unit:"ms",tags:{operation:e,success:r.toString()}})}setContext(e,t){a.o(e,t)}setTag(e,t){a.NA(e,t)}startTransaction(e,t){return n.Lk({name:e,op:t},()=>{})}captureMessage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",r=arguments.length>2?arguments[2]:void 0;o.v4(s=>{s.setLevel(t),r&&s.setContext("extra",r),s.setTag("user_role",this.userRole||"unknown"),a.wd(e)})}async flush(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2e3;return a.bX(e)}constructor(){this.userId=null,this.userRole=null,this.initializeUserContext()}}let u=d.getInstance()},25731:(e,t,r)=>{"use strict";r.d(t,{A:()=>d,AuthProvider:()=>c});var a=r(95155),s=r(12115),n=r(66579),o=r(45404),i=r(35317);let l=(0,s.createContext)({user:null,role:null,loading:!0,logout:async()=>{}}),c=e=>{let{children:t}=e,[r,c]=(0,s.useState)(null),[d,u]=(0,s.useState)(null),[m,h]=(0,s.useState)(!0);(0,s.useEffect)(()=>{let e=(0,o.hg)(n.j,async e=>{try{if(e){c(e);let t="admin@moai.com"===e.email||"admin"===e.uid||e.email&&e.email.includes("admin"),r=(0,i.doc)(n.db,"users",e.uid),a=await (0,i.getDoc)(r),s=0,o=t?2:5;for(;!a.exists()&&s<o;){let t=Math.min(500*Math.pow(2,s),8e3);console.log("AuthContext: Retrying user document fetch (".concat(s+1,"/").concat(o,") after ").concat(t,"ms for ").concat(e.email)),await new Promise(e=>setTimeout(e,t)),a=await (0,i.getDoc)(r),s++}if(a.exists()){let s=a.data().role;t&&"Admin"!==s&&(s="Admin",await (0,i.BN)(r,{role:"Admin"},{merge:!0})),u(s),console.log("AuthContext: User ".concat(e.email," has role: ").concat(s))}else if(t)await (0,i.BN)(r,{role:"Admin"},{merge:!0}),u("Admin"),console.log("AuthContext: Created Admin role for ".concat(e.email));else{console.warn("AuthContext: User ".concat(e.email," document not found after ").concat(s," retries. This may indicate a network issue or missing registration.")),setTimeout(()=>{u(null),console.log("AuthContext: Set role to null for ".concat(e.email," after extended wait"))},2e3);return}}else c(null),u(null)}catch(t){console.error("Auth state change error:",t),e?(c(e),u("admin@moai.com"===e.email||"admin"===e.uid||e.email&&e.email.includes("admin")?"Admin":null)):(c(null),u(null))}finally{h(!1)}});return()=>e()},[]);let x=async()=>{try{await (0,o.CI)(n.j);try{await fetch("/api/auth/logout",{method:"POST"})}catch(e){console.warn("API logout failed, but Firebase logout succeeded:",e)}}catch(e){console.error("Error signing out:",e)}};return(0,a.jsx)(l.Provider,{value:{user:r,role:d,loading:m,logout:x},children:t})},d=()=>(0,s.useContext)(l)},34964:(e,t,r)=>{"use strict";r.d(t,{Xi:()=>c,av:()=>d,j7:()=>l,tU:()=>i});var a=r(95155),s=r(12115),n=r(60704),o=r(53999);let i=n.bL,l=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)(n.B8,{ref:t,className:(0,o.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",r),...s})});l.displayName=n.B8.displayName;let c=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)(n.l9,{ref:t,className:(0,o.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",r),...s})});c.displayName=n.l9.displayName;let d=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)(n.UC,{ref:t,className:(0,o.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",r),...s})});d.displayName=n.UC.displayName},39915:(e,t,r)=>{Promise.resolve().then(r.bind(r,67884))},53999:(e,t,r)=>{"use strict";r.d(t,{$B:()=>m,$g:()=>o,Dm:()=>c,HM:()=>l,bC:()=>u,cn:()=>n,generateDeliveryCode:()=>i,uA:()=>d});var a=r(52596),s=r(39688);function n(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.QP)((0,a.$)(t))}function o(e){return"$".concat(Math.round(e).toLocaleString("es-CL"))}function i(){return Math.floor(1e3+9e3*Math.random()).toString()}function l(e){return e.replace(/(\d{2})(\d{2})/,"$1-$2")}function c(e){let t=0;return e.forEach(e=>{let r=function(e){var t,r;let a=e.toLowerCase();return a.includes("hour")?60*parseFloat((null==(t=a.match(/(\d+(?:\.\d+)?)/))?void 0:t[1])||"1"):a.includes("min")?parseInt((null==(r=a.match(/(\d+)/))?void 0:r[1])||"30"):30}(e.prepTime);r>t&&(t=r)}),t}function d(e,t){return Math.min(Math.max((new Date().getTime()-e.getTime())/6e4/t*100,0),100)}function u(e,t){let r=new Date(e);return r.setMinutes(r.getMinutes()+t),r}function m(e,t){let r=new Date,a=u(e,t).getTime()-r.getTime();if(a<=0)return"Listo";let s=Math.ceil(a/6e4);if(s<60)return"".concat(s," min");{let e=Math.floor(s/60);return"".concat(e,"h ").concat(s%60,"m")}}},66579:(e,t,r)=>{"use strict";let a;r.d(t,{db:()=>l,j:()=>i,y:()=>a});var s=r(23915),n=r(45404),o=r(35317);a=(0,s.Dk)().length?(0,s.Dk)()[0]:(0,s.Wp)({apiKey:"AIzaSyBptLm3y63BDBH9Xgt_UY40ZjsgUvMOKGI",authDomain:"hometaste-tlpog.firebaseapp.com",projectId:"hometaste-tlpog",storageBucket:"hometaste-tlpog.firebasestorage.app",messagingSenderId:"72297856520",appId:"1:72297856520:web:c7d851e4c00c67ec419bbd"});let i=(0,n.xI)(a),l=(0,o.aU)(a)},67884:(e,t,r)=>{"use strict";r.d(t,{default:()=>v});var a=r(95155),s=r(12115),n=r(88482),o=r(88145),i=r(97168),l=r(34964),c=r(17580),d=r(79397),u=r(55868),m=r(14186),h=r(85339),x=r(33109),g=r(22684),f=r(25731);function v(){let{role:e}=(0,f.A)(),[t,r]=(0,s.useState)([]),[v,p]=(0,s.useState)([]),[b,j]=(0,s.useState)(!0);(0,s.useEffect)(()=>{w()},[]);let w=async()=>{j(!0);try{let e=[{title:"Active Users",value:"1,234",change:"+12%",icon:(0,a.jsx)(c.A,{className:"h-4 w-4"}),trend:"up"},{title:"Orders Today",value:"89",change:"+8%",icon:(0,a.jsx)(d.A,{className:"h-4 w-4"}),trend:"up"},{title:"Revenue",value:"$12,345",change:"+15%",icon:(0,a.jsx)(u.A,{className:"h-4 w-4"}),trend:"up"},{title:"Avg Response Time",value:"245ms",change:"-5%",icon:(0,a.jsx)(m.A,{className:"h-4 w-4"}),trend:"down"}],t=[{id:"1",message:"Firebase connection timeout",level:"warning",timestamp:new Date(Date.now()-3e5),userId:"user123",context:{endpoint:"/api/orders"}},{id:"2",message:"Payment processing failed",level:"error",timestamp:new Date(Date.now()-9e5),userId:"user456",context:{paymentMethod:"mercadopago"}}];r(e),p(t)}catch(e){g.z.trackError(e,{component:"MonitoringDashboard"})}finally{j(!1)}};return"admin"!==e?(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(h.A,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Acceso Restringido"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Solo los administradores pueden acceder al dashboard de monitoreo."})]})}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Dashboard de Monitoreo"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"M\xe9tricas en tiempo real y monitoreo de errores"})]}),(0,a.jsxs)(i.$,{onClick:()=>{g.z.trackUserAction("dashboard_refresh","monitoring_dashboard"),w()},disabled:b,children:[(0,a.jsx)(x.A,{className:"h-4 w-4 mr-2"}),"Actualizar"]})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:t.map((e,t)=>(0,a.jsxs)(n.Zp,{children:[(0,a.jsxs)(n.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(n.ZB,{className:"text-sm font-medium",children:e.title}),e.icon]}),(0,a.jsxs)(n.Wu,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:e.value}),e.change&&(0,a.jsxs)("p",{className:"text-xs ".concat("up"===e.trend?"text-green-600":"down"===e.trend?"text-red-600":"text-muted-foreground"),children:[e.change," desde ayer"]})]})]},t))}),(0,a.jsxs)(l.tU,{defaultValue:"errors",className:"space-y-4",children:[(0,a.jsxs)(l.j7,{children:[(0,a.jsx)(l.Xi,{value:"errors",children:"Errores"}),(0,a.jsx)(l.Xi,{value:"performance",children:"Performance"}),(0,a.jsx)(l.Xi,{value:"users",children:"Usuarios"})]}),(0,a.jsx)(l.av,{value:"errors",className:"space-y-4",children:(0,a.jsxs)(n.Zp,{children:[(0,a.jsx)(n.aR,{children:(0,a.jsx)(n.ZB,{children:"Errores Recientes"})}),(0,a.jsx)(n.Wu,{children:0===v.length?(0,a.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"No hay errores recientes. \xa1Excelente!"}):(0,a.jsx)("div",{className:"space-y-4",children:v.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)(o.E,{variant:"error"===e.level?"destructive":"warning"===e.level?"secondary":"outline",children:e.level}),(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:e.timestamp.toLocaleString()})]}),(0,a.jsx)("p",{className:"font-medium",children:e.message}),e.context&&(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:JSON.stringify(e.context)})]}),(0,a.jsx)(i.$,{variant:"outline",size:"sm",onClick:()=>{var t;return t=e.id,void(g.z.trackUserAction("error_resolve","monitoring_dashboard",{errorId:t}),p(e=>e.filter(e=>e.id!==t)))},children:"Resolver"})]},e.id))})})]})}),(0,a.jsx)(l.av,{value:"performance",className:"space-y-4",children:(0,a.jsxs)(n.Zp,{children:[(0,a.jsx)(n.aR,{children:(0,a.jsx)(n.ZB,{children:"M\xe9tricas de Performance"})}),(0,a.jsx)(n.Wu,{children:(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"p-4 border rounded-lg",children:[(0,a.jsx)("h4",{className:"font-medium mb-2",children:"API Response Times"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-green-600",children:"245ms"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Promedio"})]}),(0,a.jsxs)("div",{className:"p-4 border rounded-lg",children:[(0,a.jsx)("h4",{className:"font-medium mb-2",children:"Error Rate"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-red-600",children:"0.12%"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"\xdaltimas 24h"})]})]})})})]})}),(0,a.jsx)(l.av,{value:"users",className:"space-y-4",children:(0,a.jsxs)(n.Zp,{children:[(0,a.jsx)(n.aR,{children:(0,a.jsx)(n.ZB,{children:"Actividad de Usuarios"})}),(0,a.jsx)(n.Wu,{children:(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"p-4 border rounded-lg text-center",children:[(0,a.jsx)("p",{className:"text-2xl font-bold",children:"1,234"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Usuarios Activos"})]}),(0,a.jsxs)("div",{className:"p-4 border rounded-lg text-center",children:[(0,a.jsx)("p",{className:"text-2xl font-bold",children:"89"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Pedidos Hoy"})]}),(0,a.jsxs)("div",{className:"p-4 border rounded-lg text-center",children:[(0,a.jsx)("p",{className:"text-2xl font-bold",children:"4.8"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Rating Promedio"})]})]})})})]})})]})]})}},88145:(e,t,r)=>{"use strict";r.d(t,{E:()=>i});var a=r(95155);r(12115);var s=r(74466),n=r(53999);let o=(0,s.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:t,variant:r,...s}=e;return(0,a.jsx)("div",{className:(0,n.cn)(o({variant:r}),t),...s})}},88482:(e,t,r)=>{"use strict";r.d(t,{BT:()=>c,Wu:()=>d,ZB:()=>l,Zp:()=>o,aR:()=>i});var a=r(95155),s=r(12115),n=r(53999);let o=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm transition-all duration-300 hover:shadow-lg",r),...s})});o.displayName="Card";let i=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",r),...s})});i.displayName="CardHeader";let l=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("h3",{ref:t,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",r),...s})});l.displayName="CardTitle";let c=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("p",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",r),...s})});c.displayName="CardDescription";let d=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",r),...s})});d.displayName="CardContent",s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",r),...s})}).displayName="CardFooter"},97168:(e,t,r)=>{"use strict";r.d(t,{$:()=>d});var a=r(95155),s=r(12115),n=r(99708),o=r(74466),i=r(38274),l=r(53999);let c=(0,o.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-xl text-sm font-semibold transition-all duration-300 transform hover:scale-105 active:scale-95 disabled:pointer-events-none disabled:opacity-50 disabled:hover:scale-100 disabled:active:scale-100 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:ring-2 focus-visible:ring-offset-2 relative overflow-hidden group",{variants:{variant:{default:"bg-gradient-to-r from-moai-500 to-moai-600 text-white shadow-lg hover:shadow-xl hover:shadow-moai-500/25 border-0 hover:from-moai-600 hover:to-moai-700",destructive:"bg-gradient-to-r from-red-500 to-red-600 text-white shadow-lg hover:shadow-xl hover:shadow-red-500/25 hover:from-red-600 hover:to-red-700",outline:"border-2 border-moai-200 bg-background/80 backdrop-blur-sm shadow-sm hover:bg-moai-50 hover:text-moai-700 hover:border-moai-300 hover:shadow-md",secondary:"bg-gradient-to-r from-pacific-500 to-pacific-600 text-white shadow-lg hover:shadow-xl hover:shadow-pacific-500/25 hover:from-pacific-600 hover:to-pacific-700",ghost:"hover:bg-moai-50/80 hover:text-moai-700 hover:backdrop-blur-sm",link:"text-moai-600 underline-offset-4 hover:underline hover:text-moai-700 p-0 h-auto shadow-none hover:shadow-none",glass:"bg-white/10 backdrop-blur-md border border-white/20 text-white shadow-lg hover:bg-white/20 hover:shadow-xl",premium:"bg-gradient-to-r from-amber-400 via-orange-500 to-red-500 text-white shadow-lg hover:shadow-xl hover:shadow-orange-500/30 hover:from-amber-500 hover:via-orange-600 hover:to-red-600"},size:{default:"h-11 px-6 py-2",sm:"h-9 rounded-lg gap-1.5 px-4 text-xs",lg:"h-12 rounded-xl px-8 text-base",xl:"h-14 rounded-xl px-10 text-lg",icon:"size-11"}},defaultVariants:{variant:"default",size:"default"}}),d=s.forwardRef((e,t)=>{let{className:r,variant:s,size:o,asChild:d=!1,loading:u=!1,icon:m,glow:h=!1,children:x,...g}=e,f=d?n.DX:"button";return(0,a.jsxs)(f,{className:(0,l.cn)(c({variant:s,size:o,className:r})),ref:t,disabled:u||g.disabled,...g,children:[(0,a.jsx)("div",{className:"absolute inset-0 -translate-x-full group-hover:translate-x-full transition-transform duration-1000 bg-gradient-to-r from-transparent via-white/20 to-transparent"}),h&&(0,a.jsx)("div",{className:"absolute inset-0 rounded-xl bg-gradient-to-r from-moai-500/20 to-pacific-500/20 blur-xl group-hover:blur-2xl transition-all duration-300 opacity-0 group-hover:opacity-100"}),u&&(0,a.jsx)(i.P.div,{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full",animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"}}),m&&!u&&(0,a.jsx)(i.P.div,{whileHover:{scale:1.1},transition:{type:"spring",stiffness:400,damping:10},children:m}),(0,a.jsx)("span",{className:"relative z-10 flex items-center gap-2",children:x})]})});d.displayName="Button"}},e=>{e.O(0,[9135,3965,6331,2670,1492,8034,4857,9631,7214,8441,5964,7358],()=>e(e.s=39915)),_N_E=e.O()}]);