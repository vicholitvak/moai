"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2610],{22610:(e,a,s)=>{s.d(a,{y:()=>N});var r=s(95155),t=s(12115),l=s(38564),i=s(40646),c=s(71007),n=s(69074),d=s(70333),o=s(6824),m=s(46751),x=s(25731),u=s(97168),h=s(99474),g=s(88482),f=s(69663),j=s(56671),p=s(41397),v=s(53999);function N(e){let{cookerId:a,dishId:s,dishName:N,orderId:b,onReviewSubmit:y}=e,{user:w}=(0,x.A)(),[k,R]=(0,t.useState)([]),[C,S]=(0,t.useState)(!0),[A,E]=(0,t.useState)(!1),[Z,M]=(0,t.useState)(0),[T,W]=(0,t.useState)(0),[B,P]=(0,t.useState)(""),[z,L]=(0,t.useState)(!1),[_,$]=(0,t.useState)(!1),[D,I]=(0,t.useState)({average:0,total:0,distribution:[0,0,0,0,0]});(0,t.useEffect)(()=>{a&&U()},[a,s]);let U=async()=>{try{S(!0);let e=[];if(s?e=await m.ReviewsService.getReviewsByDish(s):a&&(e=await m.ReviewsService.getReviewsByCook(a)),R(e),e.length>0){let a=e.reduce((e,a)=>e+a.rating,0)/e.length,s=[0,0,0,0,0];e.forEach(e=>{s[e.rating-1]++}),I({average:a,total:e.length,distribution:s})}w&&e.some(e=>e.customerId===w.uid)&&$(!0)}catch(e){console.error("Error loading reviews:",e),j.oR.error("Error al cargar las rese\xf1as")}finally{S(!1)}},q=async()=>{if(!w||!a||0===Z)return void j.oR.error("Por favor selecciona una calificaci\xf3n");if(B.trim().length<10)return void j.oR.error("Por favor escribe un comentario m\xe1s detallado (m\xednimo 10 caracteres)");try{E(!0);let e={customerId:w.uid,customerName:w.displayName||"Usuario",customerAvatar:w.photoURL||"",cookerId:a,dishId:s,dishName:N,orderId:b,rating:Z,comment:B.trim(),verified:!!b};await m.ReviewsService.createReview(e)&&(j.oR.success("\xa1Rese\xf1a publicada exitosamente!"),M(0),P(""),L(!1),$(!0),U(),null==y||y())}catch(e){console.error("Error submitting review:",e),j.oR.error("Error al publicar la rese\xf1a")}finally{E(!1)}},F=e=>{let{value:a,size:s="md",interactive:t=!1,onRate:i=()=>{}}=e,c={sm:"h-4 w-4",md:"h-5 w-5",lg:"h-6 w-6"};return(0,r.jsx)("div",{className:"flex gap-0.5",children:[1,2,3,4,5].map(e=>(0,r.jsx)("button",{type:"button",disabled:!t,onClick:()=>t&&i(e),onMouseEnter:()=>t&&W(e),onMouseLeave:()=>t&&W(0),className:(0,v.cn)("transition-all",t&&"hover:scale-110"),children:(0,r.jsx)(l.A,{className:(0,v.cn)(c[s],"transition-colors",(t&&T||a)>=e?"fill-atacama-orange text-atacama-orange":"fill-gray-200 text-gray-200")})},e))})};return C?(0,r.jsx)(g.Zp,{className:"w-full",children:(0,r.jsx)(g.Wu,{className:"p-8",children:(0,r.jsx)("div",{className:"flex items-center justify-center",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-atacama-orange"})})})}):(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)(g.Zp,{children:[(0,r.jsx)(g.aR,{children:(0,r.jsx)(g.ZB,{children:"Rese\xf1as y Calificaciones"})}),(0,r.jsxs)(g.Wu,{children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"text-4xl font-bold text-atacama-orange",children:D.average.toFixed(1)}),(0,r.jsx)(F,{value:Math.round(D.average),size:"lg"}),(0,r.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:[D.total," rese\xf1a",1!==D.total?"s":""]})]}),(0,r.jsx)("div",{className:"col-span-2 space-y-2",children:[5,4,3,2,1].map(e=>{let a=D.distribution[e-1],s=D.total>0?a/D.total*100:0;return(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-sm w-3",children:e}),(0,r.jsx)(l.A,{className:"h-4 w-4 fill-atacama-orange text-atacama-orange"}),(0,r.jsx)(p.k,{value:s,className:"flex-1 h-2"}),(0,r.jsx)("span",{className:"text-sm text-muted-foreground w-10 text-right",children:a})]},e)})})]}),w&&!_&&!z&&(0,r.jsx)(u.$,{onClick:()=>L(!0),className:"w-full mt-6 bg-atacama-orange hover:bg-atacama-orange/90",children:"Escribir una rese\xf1a"}),z&&(0,r.jsx)(g.Zp,{className:"mt-6 border-atacama-orange/20",children:(0,r.jsx)(g.Wu,{className:"pt-6",children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Tu calificaci\xf3n"}),(0,r.jsx)(F,{value:Z,size:"lg",interactive:!0,onRate:M})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Tu comentario"}),(0,r.jsx)(h.T,{value:B,onChange:e=>P(e.target.value),placeholder:"Comparte tu experiencia con este plato o cocinero...",rows:4,className:"resize-none"}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"M\xednimo 10 caracteres"})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(u.$,{onClick:q,disabled:A||0===Z,className:"flex-1 bg-atacama-orange hover:bg-atacama-orange/90",children:A?"Publicando...":"Publicar rese\xf1a"}),(0,r.jsx)(u.$,{variant:"outline",onClick:()=>{L(!1),M(0),P("")},disabled:A,children:"Cancelar"})]})]})})}),_&&(0,r.jsx)("div",{className:"mt-6 p-4 bg-green-50 dark:bg-green-950/20 rounded-lg border border-green-200 dark:border-green-800",children:(0,r.jsxs)("div",{className:"flex items-center gap-2 text-green-700 dark:text-green-400",children:[(0,r.jsx)(i.A,{className:"h-5 w-5"}),(0,r.jsx)("span",{className:"font-medium",children:"Ya has dejado una rese\xf1a"})]})})]})]}),k.length>0&&(0,r.jsxs)(g.Zp,{children:[(0,r.jsx)(g.aR,{children:(0,r.jsx)(g.ZB,{children:"Todas las rese\xf1as"})}),(0,r.jsx)(g.Wu,{className:"space-y-4",children:k.map(e=>(0,r.jsx)(g.Zp,{className:"border-gray-100 dark:border-gray-800",children:(0,r.jsx)(g.Wu,{className:"pt-6",children:(0,r.jsxs)("div",{className:"flex items-start gap-4",children:[(0,r.jsxs)(f.eu,{children:[(0,r.jsx)(f.BK,{src:e.customerAvatar}),(0,r.jsx)(f.q5,{children:(0,r.jsx)(c.A,{className:"h-4 w-4"})})]}),(0,r.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"font-medium",children:e.customerName}),e.verified&&(0,r.jsxs)("div",{className:"flex items-center gap-1 text-xs text-green-600 dark:text-green-400",children:[(0,r.jsx)(i.A,{className:"h-3 w-3"}),(0,r.jsx)("span",{children:"Compra verificada"})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,r.jsx)(F,{value:e.rating,size:"sm"}),e.dishName&&(0,r.jsxs)("span",{className:"text-sm text-muted-foreground",children:["â€¢ ",e.dishName]})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[(0,r.jsx)(n.A,{className:"h-3 w-3"}),(0,o.GP)(e.createdAt.toDate(),"dd MMM yyyy")]})]}),(0,r.jsx)("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:e.comment}),(0,r.jsxs)("button",{className:"flex items-center gap-1 text-sm text-muted-foreground hover:text-atacama-orange transition-colors",children:[(0,r.jsx)(d.A,{className:"h-3 w-3"}),(0,r.jsx)("span",{children:"\xdatil"})]})]})]})})},e.id))})]}),0===k.length&&!z&&(0,r.jsx)(g.Zp,{children:(0,r.jsx)(g.Wu,{className:"p-8 text-center text-muted-foreground",children:(0,r.jsx)("p",{children:"A\xfan no hay rese\xf1as. \xa1S\xe9 el primero en compartir tu experiencia!"})})})]})}},41397:(e,a,s)=>{s.d(a,{k:()=>c});var r=s(95155),t=s(12115),l=s(55863),i=s(53999);let c=t.forwardRef((e,a)=>{let{className:s,value:t,...c}=e;return(0,r.jsx)(l.bL,{ref:a,className:(0,i.cn)("relative h-2 w-full overflow-hidden rounded-full bg-primary/20",s),...c,children:(0,r.jsx)(l.C1,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(t||0),"%)")}})})});c.displayName=l.bL.displayName},99474:(e,a,s)=>{s.d(a,{T:()=>i});var r=s(95155),t=s(12115),l=s(53999);let i=t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,r.jsx)("textarea",{className:(0,l.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:a,...t})});i.displayName="Textarea"}}]);